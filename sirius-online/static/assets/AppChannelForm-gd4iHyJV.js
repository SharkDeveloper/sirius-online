import{B as ie,b as U,c as y,H as re,ad as de,ae as ue,u as K,i as me,a as j,d as J,o as L,e as k,w as T,f as B,g as b,h as e,D as X,G as H,j as z,k as W,v as Y,m as _,n as I,p as ee,M as ce,l as q,af as fe,Q as pe,O as be,ag as ge,ah as ve,ai as ye,F as Ee}from"./app-X261GMLD.js";import{u as te}from"./useConfigDialog-CoOncFYH.js";import{g as xe,a as Ae,u as ne}from"./useConfigForm-Dwead9lM.js";import{g as P}from"./getUpdatedElement-DO3HsR5I.js";import{A as Q,u as Le}from"./AppDragAndDropArea-Cr3Xjs1I.js";import{_ as le,A as ae}from"./AppConfigFormHeader-CpKOoRvu.js";const oe=(t,m)=>{const c=ie().getters["config/getElementList"];return["device","input","output","reader","channel"].map(v=>xe(Object.values(c(v)),"contact_id",v===t?m:void 0)).flat().map(Number)},se=t=>{const m=U(),g=y(()=>m.getters["zone/ZONE_LIST"]),c=y(()=>m.getters["device/DEVICE_LIST"]),{maxElementsToast:f}=Ae(),v=y(()=>{var d,l;return(l=g.value[(d=t.value)==null?void 0:d.zone_index])==null?void 0:l.isZonePt}),E=y(()=>re(t.value)||v.value),i=y(()=>de(t.value)),r=y(()=>{var d,l;return(l=c.value[(d=t.value)==null?void 0:d.device_index])==null?void 0:l.isKDL});return{isReadonly:E,isReplaceable:i,isBelongKdlDevice:r,isAttachedZonePt:v,checkMaxElements:(d,l)=>{const s=(Array.isArray(d)?d:[d]).filter(D=>!Number.isInteger(D.index)),{maxCount:A,data:N}=m.getters["config/CONFIG"][l],V=Object.keys(N).length,R=s.length;return V+R>A?(f(A),!1):!0}}};function Ne(t){const m=JSON.parse(JSON.stringify(t[0]));for(let g in m)t.every(c=>ue(c[g],m[g]))||delete m[g];return m}const Re={class:"config-form__body"},ke={class:"config-form__buttons"},Ue={__name:"AppReaderForm",props:{elements:{type:Array,default:()=>[]},closable:{type:Boolean,default:!1}},emits:["update:elements"],setup(t,{emit:m}){const{t:g}=K(),c=me("rightTree"),f=j(),v=U(),E=t,i=m,{form:r,formRef:C,deleteButtonRef:d,isSaving:l,onSave:p,isDeleting:s,onDelete:A,isNew:N,isMultipleEditing:V,mainFormElement:R,deleteButtonLabel:D,saveButtonLabel:S,onReset:F}=ne({props:E,saveFn:Z,deleteFn:$,resetFn:G}),{isReadonly:O,checkMaxElements:w}=se(R),{confirmElementsDeletion:M,confirmDuplicateContactId:h}=te();function G({form:a,mainFormElement:o,isMultipleEditing:n}){if(n.value){a.value=Ne(E.elements);return}a.value=J(o.value)}async function Z(){const a=P(r.value),o=E.elements.map(n=>P({...n,...a}));if(w(o,"reader")&&!(u.value&&!await h()))return l.value=!0,await v.dispatch("config/saveElement",{elementList:o.map(n=>({data:n,type:n.elementType}))}),i("update:elements",o),!0}async function $(){const a=[...E.elements],o=await M(a);if(o)return s.value=!0,await v.dispatch("config/deleteElement",{elementList:o.map(n=>({index:n.index,type:n.elementType}))}),!0}const x=y(()=>oe("reader",r.value.index)),u=y(()=>x.value.includes(r.value.contact_id));return(a,o)=>(L(),k(ee,{class:"config-form",ref_key:"formRef",ref:C,onSubmit:e(p),onReset:e(F)},{default:T(()=>[B("div",Re,[b(le,{title:e(X)(e(R)),marker:e(H)(e(R)).extendedMarker,"multiple-editing":e(V),elements:t.elements,"onUpdate:elements":o[0]||(o[0]=n=>i("update:elements",n)),onClose:o[1]||(o[1]=n=>i("close")),closable:t.closable},null,8,["title","marker","multiple-editing","elements","closable"]),b(ae,{label:e(f).CONFIGURATION.DEVICES.mainSettings},{default:T(()=>[b(z,{modelValue:e(r).name,"onUpdate:modelValue":o[2]||(o[2]=n=>e(r).name=n),modelModifiers:{trim:!0},"data-testid":"name-input",label:e(f).GENERAL.LABEL.name,rules:e(W),disable:e(O),maxlength:"31",class:"b-field"},null,8,["modelValue","label","rules","disable"]),e(V)?_("",!0):(L(),k(z,{key:0,modelValue:e(r).contact_id,"onUpdate:modelValue":o[3]||(o[3]=n=>e(r).contact_id=n),modelModifiers:{number:!0},min:1,max:999,hint:e(g)("error.range",{min:1,max:999}),rules:[n=>e(Y).coerce.number().integer().min(1).max(999).validate(n)],type:"number",label:"Contact ID","data-testid":"contact-id-input",class:"b-field"},null,8,["modelValue","hint","rules"])),b(e(Q),{modelValue:e(r).allowed_zones,"onUpdate:modelValue":o[4]||(o[4]=n=>e(r).allowed_zones=n),label:e(f).CONFIGURATION.READERS.LABEL.allowed_zones,items:e(c),type:"zone","data-testid":"allowed-zones-dnd","data-key":"index",itemMarker:"extendedMarker"},null,8,["modelValue","label","items"]),b(e(Q),{modelValue:e(r).allowed_zonegroups,"onUpdate:modelValue":o[5]||(o[5]=n=>e(r).allowed_zonegroups=n),label:e(f).CONFIGURATION.READERS.LABEL.allowed_zonegroups,items:e(c),type:"zone_group","data-testid":"allowed-zonegroups-dnd","data-key":"index",itemMarker:"extendedMarker"},null,8,["modelValue","label","items"])]),_:1},8,["label"])]),B("div",ke,[e(N)?_("",!0):(L(),k(I,{key:0,label:e(f).GENERAL.BUTTON.reset,class:"text-button fill-input",type:"reset","data-testid":"form-reset-btn"},null,8,["label"])),!e(N)&&!e(O)?(L(),k(I,{key:1,ref_key:"deleteButtonRef",ref:d,label:e(D),loading:e(s),disable:e(l),class:"text-button",color:"negative","data-testid":"form-delete-btn",onClick:e(A)},null,8,["label","loading","disable","onClick"])):_("",!0),b(I,{label:e(S),loading:e(l),disable:e(s),class:"text-button","data-testid":"form-save-btn",color:"positive",type:"submit"},null,8,["label","loading","disable"])])]),_:1},8,["onSubmit","onReset"]))}},Ie={key:0,class:"row justify-end"},Ce={__name:"AppZoneSelect",props:{disable:{type:Boolean,default:!1},includeZonesPt:{type:Boolean,default:!1},excludeAlienZones:{type:Boolean,default:!1},modelValue:{type:[String,Number,null],default:null}},emits:["update:modelValue"],setup(t,{emit:m}){const g=j(),c=U(),f=t,v=m,E=y(()=>c.getters["zone/ZONE_LIST"]),i=y(()=>Object.values(c.getters["zone/zoneArray"])),r=y(()=>{let l=[];l.push({label:g.value.CONFIGURATION.GENERAL.notSetParentheses,value:65535});let p=i.value;return f.includeZonesPt||(p=p.filter(s=>s.isZonePt===!1)),f.excludeAlienZones&&(p=p.filter(s=>s.controller_index===ce)),l.concat(p.map(s=>({label:s.formattedName,value:s.index,number:s.number})).sort((s,A)=>s.number-A.number))}),{redirectToConfigPage:C}=Le(),d=()=>{const l=E.value[f.modelValue];C({id:l.uniqueIndex,type:"zone",data:l})};return(l,p)=>(L(),q(Ee,null,[b(pe,fe(l.$attrs,{"model-value":t.modelValue,"onUpdate:modelValue":p[0]||(p[0]=s=>v("update:modelValue",s)),options:r.value,disable:t.disable,"emit-value":"","map-options":"","data-testid":"zone-select"}),null,16,["model-value","options","disable"]),t.modelValue!==e(be)&&Number.isInteger(t.modelValue)?(L(),q("div",Ie,[b(I,{onClick:d,dense:"",flat:"",color:"black",padding:"4px","data-testid":"zone-select-redirect-btn",class:"print-hide"},{default:T(()=>[B("div",null,ge(e(g).GENERAL.LABEL.redirectToZone),1),b(ve,{size:"24px",class:"rotate-45",name:e(ye)},null,8,["name"])]),_:1})])):_("",!0)],64))}},Ve={class:"config-form__body"},_e={class:"config-form__buttons"},Fe={__name:"AppChannelForm",props:{elements:{type:Array,default:()=>[]},closable:{type:Boolean,default:!1}},emits:["update:elements"],setup(t,{emit:m}){const{t:g}=K(),c=j(),f=U(),v=t,E=m,{form:i,formRef:r,deleteButtonRef:C,isSaving:d,onSave:l,isDeleting:p,onDelete:s,isNew:A,mainFormElement:N,deleteButtonLabel:V,saveButtonLabel:R,onReset:D}=ne({props:v,saveFn:h,deleteFn:G,resetFn:M}),{isReadonly:S,checkMaxElements:F}=se(N),{confirmElementsDeletion:O,confirmDuplicateContactId:w}=te();function M({form:x,mainFormElement:u}){x.value=J(u.value)}async function h(){const x=P(i.value);if(F(x,"channel")&&!($.value&&!await w()))return d.value=!0,await f.dispatch("config/saveElement",{data:x,type:"channel"}),E("update:elements",[x]),!0}async function G(){const x=[...v.elements],u=await O(x);if(u)return p.value=!0,await f.dispatch("config/deleteElement",{elementList:u.map(a=>({index:a.index,type:a.elementType}))}),!0}const Z=y(()=>oe("channel",i.value.index)),$=y(()=>Z.value.includes(i.value.contact_id));return(x,u)=>(L(),k(ee,{class:"config-form",ref_key:"formRef",ref:r,onSubmit:e(l),onReset:e(D)},{default:T(()=>[B("div",Ve,[b(le,{title:e(X)(e(N)),marker:e(H)(e(N)).extendedMarker,onClose:u[0]||(u[0]=a=>E("close")),closable:t.closable,"onUpdate:elements":u[1]||(u[1]=a=>E("update:elements",a))},null,8,["title","marker","closable"]),b(ae,{label:e(c).CONFIGURATION.DEVICES.mainSettings},{default:T(()=>[b(z,{modelValue:e(i).name,"onUpdate:modelValue":u[2]||(u[2]=a=>e(i).name=a),modelModifiers:{trim:!0},"data-testid":"name-input",label:e(c).GENERAL.LABEL.name,rules:e(W),disable:e(S),maxlength:"31",class:"b-field"},null,8,["modelValue","label","rules","disable"]),b(Ce,{modelValue:e(i).zone_index,"onUpdate:modelValue":u[3]||(u[3]=a=>e(i).zone_index=a),label:e(c).GENERAL.LABEL.zone,"popup-content-class":"b-select-popup",class:"b-field","exclude-alien-zones":""},null,8,["modelValue","label"]),b(z,{modelValue:e(i).contact_id,"onUpdate:modelValue":u[4]||(u[4]=a=>e(i).contact_id=a),modelModifiers:{number:!0},min:1,max:999,hint:e(g)("error.range",{min:1,max:999}),rules:[a=>e(Y).coerce.number().integer().min(1).max(999).validate(a)],type:"number",label:"Contact ID","data-testid":"contact-id-input",class:"b-field"},null,8,["modelValue","hint","rules"])]),_:1},8,["label"])]),B("div",_e,[e(A)?_("",!0):(L(),k(I,{key:0,label:e(c).GENERAL.BUTTON.reset,class:"text-button fill-input",type:"reset","data-testid":"form-reset-btn"},null,8,["label"])),!e(A)&&!e(S)?(L(),k(I,{key:1,ref_key:"deleteButtonRef",ref:C,label:e(V),loading:e(p),disable:e(d),class:"text-button",color:"negative","data-testid":"form-delete-btn",onClick:e(s)},null,8,["label","loading","disable","onClick"])):_("",!0),b(I,{label:e(R),loading:e(d),disable:e(p),class:"text-button","data-testid":"form-save-btn",color:"positive",type:"submit"},null,8,["label","loading","disable"])])]),_:1},8,["onSubmit","onReset"]))}};export{Ce as _,Ue as a,Fe as b,Ne as f,oe as g,se as u};
