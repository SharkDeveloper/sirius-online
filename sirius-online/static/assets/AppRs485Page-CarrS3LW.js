import{av as w,u as D,a as M,b as B,bu as G,c as d,r as N,P as k,E as u,o as y,l as U,e as F,w as P,f as c,ag as Q,h as e,g as r,Q as j,j as J,v as K,n as g,p as q,m as z,cf as X,F as $,M as H}from"./app-X261GMLD.js";import{A as W}from"./AppKeyEncryptionDialog-Bk20_hHA.js";import{u as Y}from"./useConfigDialog-CoOncFYH.js";import{u as Z,g as ee}from"./useConfigForm-Dwead9lM.js";import"./settings.services-CtvtW5n1.js";const te={class:"config-form__body"},ae={class:"config-form__title text-h1"},oe={class:"flex column"},ne={class:"config-form__container"},se={class:"config-form__buttons"},le={__name:"AppRs485Page",setup(re){const{t:T}=D(),n=M(),s=B();G(()=>{s.dispatch("config/fetchAndSetElementList",{types:["controller"]}).then(()=>{_(),f.value=!0}).catch(t=>{console.error(t)})});const i=d(()=>s.getters["controller/masterController"]),m=d(()=>Object.values(s.getters["controller/CONTROLLER_LIST"])||[]),{form:l,formRef:h,onSave:R,onReset:_,isSaving:p}=Z({saveFn:A,resetFn:E}),f=N(!1),{showContinueDialog:O}=Y();k(i,()=>E({form:l}),{immediate:!0,deep:!0});function E({form:t}){i.value&&(t.value=JSON.parse(JSON.stringify(i.value)))}async function A(){const t=JSON.parse(JSON.stringify(l.value)),a=t.address!==i.value.address,S=t.interpanel_mode===u.standalone&&t.interpanel_mode!==i.value.interpanel_mode&&m.value.length>1,C=n.value.SETTINGS.RS485.INTERPANEL_MODE[u.standalone],V=n.value.SETTINGS.RS485.SAVE_DIALOG.body;if(!(S&&!await O(C,V)))return p.value=!0,await s.dispatch("config/saveElement",{data:t,type:"controller"}),a&&s.dispatch("controller/updateControllerElements"),S&&(await s.dispatch("config/deleteElement",{elementList:m.value.filter(b=>b.index!==H).map(b=>({index:b.index,type:"controller"}))}),await s.dispatch("config/integrityCheck")),!0}const L=d(()=>ee(Object.values(m.value),"address",l.value.index)),x=d(()=>m.value.some(t=>t.interpanel_mode===u.master)),I=d(()=>{const t=Object.entries(n.value.SETTINGS.RS485.INTERPANEL_MODE).map(([a,o])=>({label:o,value:Number(a)}));return x.value&&i.value.interpanel_mode!==u.master?t.filter(a=>a.value!==u.master):t}),v=N(!1);return(t,a)=>(y(),U($,null,[f.value?(y(),F(q,{key:0,onReset:e(_),onSubmit:e(R),ref_key:"formRef",ref:h,class:"config-form"},{default:P(()=>[c("div",te,[c("div",ae,Q(e(n).ROUTER.SETTINGS.rs485),1),c("div",oe,[c("div",ne,[r(j,{modelValue:e(l).interpanel_mode,"onUpdate:modelValue":a[0]||(a[0]=o=>e(l).interpanel_mode=o),options:I.value,label:e(n).SETTINGS.RS485.LABEL.interpanel_mode,"data-testid":"interpanel-mode-select","emit-value":"","map-options":"",class:"b-field"},null,8,["modelValue","options","label"]),r(J,{modelValue:e(l).address,"onUpdate:modelValue":a[1]||(a[1]=o=>e(l).address=o),modelModifiers:{number:!0},label:e(n).GENERAL.LABEL.address+" *",rules:[o=>e(K).coerce.number().required().integer().min(1).max(32).notIn(L.value).validate(o)],hint:e(T)("error.range",{min:1,max:32}),type:"number",max:"32",min:"1","data-testid":"address-input",class:"b-field"},null,8,["modelValue","label","rules","hint"])]),r(g,{label:e(n).SETTINGS.MAIN.BUTTON.changeKeyEncryption,onClick:a[2]||(a[2]=o=>v.value=!0),class:"change-button text-button bg-back ml-auto","data-testid":"orion-key-encryption-btn","text-color":"primary"},null,8,["label"])])]),c("div",se,[r(g,{label:e(n).GENERAL.BUTTON.reset,disable:e(p),class:"text-button fill-input",type:"reset","data-testid":"form-reset-btn"},null,8,["label","disable"]),r(g,{loading:e(p),label:e(n).GENERAL.BUTTON.save,disable:e(p),class:"text-button","data-testid":"form-save-btn",color:"positive",type:"submit"},null,8,["loading","label","disable"])])]),_:1},8,["onReset","onSubmit"])):z("",!0),r(W,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=o=>v.value=o),type:"controller"},null,8,["modelValue"]),r(X,{showing:!f.value,color:"primary",size:"xl"},null,8,["showing"])],64))}},pe=w(le,[["__scopeId","data-v-7706ede4"]]);export{pe as default};
