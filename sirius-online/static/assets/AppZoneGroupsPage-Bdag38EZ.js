import{a as F,u as J,i as K,b as w,c as m,d as W,o as i,e as f,w as Z,f as D,g as o,h as e,j as L,k as Y,v as h,a3 as ee,m as R,n as V,p as te,ao as ne,q as ae,r as le,l as S,T as oe,F as se,ap as re,A as ie}from"./app-X261GMLD.js";import{_ as ue,A as de,a as B}from"./AppConfigFormHeader-CpKOoRvu.js";import{u as me,a as ce}from"./useConfigForm-Dwead9lM.js";import{u as pe}from"./useConfigDialog-CoOncFYH.js";import{g as fe}from"./getUpdatedElement-DO3HsR5I.js";import{A as be}from"./AppDragAndDropArea-Cr3Xjs1I.js";import{u as M}from"./useConfigZone-Bz7OuTNL.js";const ge={class:"config-form__body"},_e={class:"config-form__buttons"},Ee={__name:"AppZoneGroupForm",props:{elements:{type:Array,default:()=>[]}},emits:["update:elements"],setup(z,{emit:T}){const{confirmEmptyElementDeletion:b,showDeleteDialog:x}=pe(),l=F(),{t:g}=J(),_=K("rightTree"),E=z,A=T,{form:n,formRef:U,deleteButtonRef:G,isSaving:u,onSave:O,isDeleting:c,onDelete:k,isNew:I,mainFormElement:N,deleteButtonLabel:v,saveButtonLabel:p,onReset:y}=me({props:E,saveFn:X,deleteFn:$,resetFn:j}),{nonUniqueZoneGroupContactIds:C,nonUniqueZoneGroupNumbers:P}=M(n),d=w(),q=m(()=>d.getters["output/outputArray"]),Q=m(()=>d.getters["reader/readerArray"]);function j({form:s,mainFormElement:a}){s.value=W(a.value)}async function X(){const s=fe(n.value);return u.value=!0,await d.dispatch("config/saveElement",{data:s,type:"zone_group"}),A("update:elements",[s]),!0}async function $(){const s=n.value.index;if(!await x(l.value.CONFIGURATION.ZONE_GROUPS.DELETE_DIALOG.TITLE))return;c.value=!0;const a=q.value.filter(r=>r.related_zonegroups.includes(s)).map(r=>r.index),t=Q.value.filter(r=>r.allowed_zonegroups.includes(s)).map(r=>r.index);return await d.dispatch("config/deleteElement",{index:s,type:"zone_group",stash:!0}),await d.dispatch("config/integrityCheck"),await b(a,t,"zone_group"),!0}const H=m(()=>d.getters["controller/masterControllerIsStandalone"]);return(s,a)=>(i(),f(te,{class:"config-form",ref_key:"formRef",ref:U,onSubmit:e(O),onReset:e(y)},{default:Z(()=>[D("div",ge,[o(ue,{title:e(N).filledName,marker:e(N).number,"onUpdate:elements":a[0]||(a[0]=t=>A("update:elements",t))},null,8,["title","marker"]),o(de,{label:e(l).CONFIGURATION.DEVICES.mainSettings},{default:Z(()=>[o(L,{modelValue:e(n).name,"onUpdate:modelValue":a[1]||(a[1]=t=>e(n).name=t),modelModifiers:{trim:!0},"data-testid":"name-input",label:e(l).GENERAL.LABEL.name,rules:e(Y),maxlength:"31",class:"b-field"},null,8,["modelValue","label","rules"]),o(L,{modelValue:e(n).number,"onUpdate:modelValue":a[2]||(a[2]=t=>e(n).number=t),modelModifiers:{number:!0},min:1,max:65535,label:e(l).GENERAL.LABEL.number+" *",class:"b-field",type:"number",hint:e(g)("error.range",{min:1,max:65535}),rules:[t=>e(h).coerce.number().min(1).max(65535).notIn(e(P)).required().validate(t)],"data-testid":"number-input"},null,8,["modelValue","label","hint","rules"]),o(L,{modelValue:e(n).contact_id,"onUpdate:modelValue":a[3]||(a[3]=t=>e(n).contact_id=t),modelModifiers:{number:!0},min:1,max:99,hint:e(g)("error.range",{min:1,max:99}),rules:[t=>e(h).coerce.number().integer().min(1).max(99).notIn(e(C)).validate(t)],type:"number",label:"Contact ID","data-testid":"contact-id-input",class:"b-field"},null,8,["modelValue","hint","rules"]),H.value?R("",!0):(i(),f(ee,{key:0,modelValue:e(n).is_interpanel,"onUpdate:modelValue":a[4]||(a[4]=t=>e(n).is_interpanel=t),label:e(l).CONFIGURATION.ZONE_GROUPS.LABEL.is_interpanel,"data-testid":"is-interpanel-checkbox",class:"b-checkbox","left-label":""},null,8,["modelValue","label"])),o(e(be),{modelValue:e(n).included_zones,"onUpdate:modelValue":a[5]||(a[5]=t=>e(n).included_zones=t),label:e(l).CONFIGURATION.ZONE_GROUPS.LABEL.included_zones,items:e(_),type:"zone","data-testid":"included-zones-dnd","data-key":"index",itemMarker:"extendedMarker"},null,8,["modelValue","label","items"])]),_:1},8,["label"])]),D("div",_e,[e(I)?R("",!0):(i(),f(V,{key:0,label:e(l).GENERAL.BUTTON.reset,class:"text-button fill-input",type:"reset","data-testid":"form-reset-btn"},null,8,["label"])),e(I)?R("",!0):(i(),f(V,{key:1,ref_key:"deleteButtonRef",ref:G,label:e(v),loading:e(c),disable:e(u),class:"text-button",color:"negative","data-testid":"form-delete-btn",onClick:e(k)},null,8,["label","loading","disable","onClick"])),o(V,{loading:e(u),label:e(p),disable:e(c),class:"text-button","data-testid":"form-save-btn",color:"positive",type:"submit"},null,8,["loading","label","disable"])])]),_:1},8,["onSubmit","onReset"]))}},xe={__name:"AppZoneGroupsPage",setup(z){const{freeZoneNumber:T,MAX_COUNT_ZONE_GROUPS:b,zoneGroupArray:x}=M(),l=F(),{maxElementsToast:g}=ce(),_=w(),E=m(()=>_.getters["zone_group/ZONE_GROUP_TREE"].filter(p=>p.data.index!==ne)),A=m(()=>_.getters["zone/ZONE_TREE"]),n=m(()=>A.value),{formId:U,leftTreeRef:G,selectedElements:u,onAdd:O,selectNewTreeItemIds:c,updateSelectedElements:k,selectedTreeItemIds:I}=ae({leftTree:E,rightTree:n,add:N});function N(){if(x.value.length>=b){g(b);return}return re({...ie("zone_group"),number:T.value,index:null})}const v=le([]);return(p,y)=>(i(),S(se,null,[o(e(B),{ref_key:"leftTreeRef",ref:G,selected:e(I),"onUpdate:selected":e(c),onAdd:e(O),items:E.value,title:e(l).ROUTER.CONFIG.zoneGroups,"required-selection":"",searchable:"","add-button":""},null,8,["selected","onUpdate:selected","onAdd","items","title"]),e(u).length?(i(),f(oe,{key:0,name:"fade",mode:"out-in"},{default:Z(()=>[(i(),S("div",{class:"config-form-wrapper",key:e(U)},[o(e(Ee),{elements:e(u),"onUpdate:elements":e(k)},null,8,["elements","onUpdate:elements"])]))]),_:1})):R("",!0),o(e(B),{items:n.value,selected:v.value,"onUpdate:selected":y[0]||(y[0]=C=>v.value=C),title:e(l).GENERAL.LABEL.zones,"is-right-tree":"","can-multiple-selection":"","can-selection-all-children":"",searchable:""},null,8,["items","selected","title"])],64))}};export{xe as default};
