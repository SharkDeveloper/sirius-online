import{B as ve,aq as q,ar as Ie,J as M,as as mt,at as Re,au as Ze,y as Ve,a8 as De,av as ct,o as A,l as Ce,f as Oe,ag as vt,aw as ft,c as p,ax as _t,ay as bt,e as U,h as e,az as Le,a as ze,r as Ne,u as Me,b as Fe,d as ce,C as yt,H as We,O as ke,aA as et,N as we,S as xt,w as S,g,aB as tt,n as oe,p as Ge,Q as pe,v as $,j as me,m as F,aC as nt,ae as at,a9 as Je,P as Te,aD as he,X as Ye,Y as $e,Z as Ue,a3 as Ee,aE as gt,k as Et,F as Be,aF as He,af as Xe,aG as It,q as Ot,T as Nt,an as Tt,A as At}from"./app-X261GMLD.js";import{A as Ae,_ as Ct,a as St}from"./AppConfigFormHeader-CpKOoRvu.js";import{u as Ut}from"./useConfigDialog-CoOncFYH.js";import{g as Se}from"./getUpdatedElement-DO3HsR5I.js";import{c as lt}from"./compareConfigElements-CU2Ub2iG.js";import{A as qe}from"./AppDragAndDropArea-Cr3Xjs1I.js";import{a as je,u as Pt}from"./useConfigForm-Dwead9lM.js";import{_ as Vt}from"./AppInputInfinityTime-DnuVbfNN.js";import{_ as Qe}from"./AppInputNumber-pcfWNGSA.js";import{u as ot}from"./useConfigZone-Bz7OuTNL.js";import"./AppInputNumberWithCheckbox-C-TLkeux.js";function Dt(a,n){const o=[];for(const t of a)t.device_index==Ze&&t.type==q.autoModeStatus&&t.zone_index==n&&o.push(t);return JSON.parse(JSON.stringify(o))}function Lt(a,n){const o=[];for(const t of a)t.device_index==Ze&&t.type==q.extinguishingStatus&&t.zone_index==n&&o.push(t);return JSON.parse(JSON.stringify(o))}function kt(a,n){const o=[];for(const t of a)t.type==q.auxiliary&&t.subtype==Ie.door&&t.zone_index==n&&o.push(t);return JSON.parse(JSON.stringify(o))}function ht(a,n){const o=[];for(const t of a)t.type==q.auxiliary&&t.subtype==Ie.otv&&t.zone_index==n&&o.push(t);return JSON.parse(JSON.stringify(o))}function Rt(a,n){const o=[];for(const t of a)(t.type==q.remoteRelease||t.type==q.fire)&&t.zone_index==n&&o.push(t);return JSON.parse(JSON.stringify(o))}function zt(a,n,o){const t=[];for(const d of a)(d.program_index===n(96)||d.program_index===n(97))&&d.zone_index===o&&d.type===M.fireProtection&&t.push(d);return JSON.parse(JSON.stringify(t))}function Ft(a,n,o,t){const d=[];for(const c of a)(o&&(c.program_index===n(94)||c.program_index===n(95))||!o&&(c.program_index===n(93)||c.program_index===n(92)))&&c.zone_index===t&&c.type===M.simpleRelay&&d.push(c);return JSON.parse(JSON.stringify(d))}function wt(a,n,o){const t=[];for(const d of a)d.program_index===n(44)&&d.zone_index===o&&d.type===M.simpleRelay&&t.push(d);return JSON.parse(JSON.stringify(t))}function Bt(a,n,o){const t=[];for(const d of a)(d.program_index===n(90)||d.program_index===n(91))&&d.zone_index===o&&d.type===M.simpleRelay&&t.push(d);return JSON.parse(JSON.stringify(t))}function qt(a,n,o){const t=[];for(const d of a)(d.program_index===n(88)||d.program_index===n(89))&&d.zone_index===o&&d.type===M.simpleRelay&&t.push(d);return JSON.parse(JSON.stringify(t))}function Zt(a,n){const o=ve(),d=mt(o.getters.LANGUAGE).CONFIGURATION.ZONES_PT,c=o.getters["input/inputArray"];if(!n)return{automatic:Dt(c,a),fireFighting:Lt(c,a)};const{typeElements:P}=Re(Ze,"input"),f=P.find(I=>I.index===null);f.zone_index=a,f.name=d.INPUTS_NAME.automatic,f.type=q.autoModeStatus,f.index=Ve(c.map(I=>I.index),De);const v=P.find(I=>I.index===null&&I.uniqueIndex!==f.uniqueIndex);return v.zone_index=a,v.name=d.INPUTS_NAME.fireFighting,v.type=q.extinguishingStatus,v.index=Ve([f.index,...c.map(I=>I.index)],De),{automatic:[Se(f)],fireFighting:[Se(v)]}}function Mt(a){const n=ve(),o=n.getters["zone/ZONE_LIST"],t=n.getters["device/deviceArray"];return!Object.hasOwn(o,a)?[]:t.filter(c=>c.zone_index===a)}function Gt(a){const n=ve(),o=n.getters["input/inputArray"],t=n.getters["zone/ZONE_LIST"],d=!Object.hasOwn(t,a),{automatic:c,fireFighting:P}=Zt(a,d);return{door:d?[]:kt(o,a),otv:d?[]:ht(o,a),fire:d?[]:Rt(o,a),automatic:c,fireFighting:P}}function jt(a){const n=ve(),o=n.getters["output/outputArray"],t=n.getters["zone/ZONE_LIST"],d=n.getters["program/getProgramIndexByNumber"],c=!Object.hasOwn(t,a),P=c?[]:zt(o,d,a),f=P[0];let v=!1,I=[];return f&&(f.program_index===d(97)&&(v=!0),I=f.related_zones.filter(D=>D!==a)),{outputs:{start:P,siren:c?[]:Ft(o,d,v,a),automatic:c?[]:wt(o,d,a),leave:c?[]:Bt(o,d,a),dontComeIn:c?[]:qt(o,d,a)},startFire2:v,fireZones:I}}function it(a,n,o,t=null){const c=ve().getters["program/getProgramIndexByNumber"];switch(t===null&&(t=ut(a,n)),n){case"start":o?a.program_index=c(97):a.program_index=c(96);break;case"siren":o?t?a.program_index=c(94):a.program_index=c(95):t?a.program_index=c(92):a.program_index=c(93);break;case"automatic":a.program_index=c(44);break;case"leave":t?a.program_index=c(90):a.program_index=c(91);break;case"dontComeIn":t?a.program_index=c(88):a.program_index=c(89);break}}function ut(a,n){const t=ve().getters["program/getProgramIndexByNumber"];switch(n){case"siren":return a.program_index===t(92)||a.program_index===t(94);case"leave":return a.program_index===t(90);case"dontComeIn":return a.program_index===t(88)}}const Jt={class:"config-card"},Yt={class:"config-card__header text-h2"},$t={class:"config-card__body"},Ht={__name:"AppConfigCard",props:{label:{type:String,default:""}},setup(a){return(n,o)=>(A(),Ce("div",Jt,[Oe("div",Yt,vt(a.label),1),Oe("div",$t,[ft(n.$slots,"default",{},void 0,!0)])]))}},Pe=ct(Ht,[["__scopeId","data-v-7363fb72"]]),Ke={__name:"AppZonePtElements",props:{label:{type:String,default:""},modelValue:{type:Array,default:()=>[]},hint:{type:String,default:""},readonly:{type:Boolean,default:!1},required:{type:[Boolean,Object],default:!1},rules:{type:Array,default:()=>[]}},emits:["add","update:modelValue","editItem"],setup(a,{emit:n}){const o=a,t=n,d=p({get:()=>o.modelValue.map(f=>f.uniqueIndex),set:f=>{t("update:modelValue",o.modelValue.filter(v=>f.includes(v.uniqueIndex)))}}),c=p(()=>o.modelValue.map(f=>({id:f.uniqueIndex,type:f.elementType,label:_t(f),tags:bt(f),marker:f.uniqueIndex,nonDeletable:o.readonly,editable:!0,isNew:f.isNew,data:f})));function P(f){t("editItem",o.modelValue.find(v=>v.uniqueIndex===f))}return(f,v)=>(A(),U(qe,{modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=I=>d.value=I),label:a.label,"add-button":!a.readonly,"clear-button":!a.readonly,"edit-button":!1,hint:a.hint,items:c.value,required:a.required,type:["output","input"],"compare-items":(I,D)=>e(lt)(I.data,D.data),rules:a.rules,onAdd:v[1]||(v[1]=I=>t("add")),onEditItem:P,"close-button":"","data-key":"uniqueIndex"},null,8,["modelValue","label","add-button","clear-button","hint","items","required","compare-items","rules"]))}},Xt={__name:"AppInputDialog",props:{modelValue:{type:[Object,null],default:null},formElementByDeviceIndex:{type:Object,required:!0},type:{type:String,required:!0},zoneIndex:{type:Number,required:!0},formInputs:{type:Array,required:!0}},emits:[...Le.emits],setup(a){const n=a,o=ze(),t=p(()=>o.value.CONFIGURATION.ZONES_PT),{maxElementsToast:d}=je(),{dialogRef:c,onDialogHide:P,onDialogOK:f,onDialogCancel:v}=Le(),I=Ne(null),{t:D}=Me(),N=Fe(),G=p(()=>N.getters["device/deviceArray"]),Q=p(()=>N.getters["device/DEVICE_LIST"]),j=p(()=>N.getters["input/inputArray"]),l=p(()=>N.getters["script/mainScriptsByType"]),m=Ne({}),C=p(()=>n.modelValue===null),k=p(()=>Ve([...n.formInputs,...j.value].map(r=>r.index),De)),h={2:"all",4:"all",9:"all",15:"all",26:"all",34:"all",40:"all",41:"all",68:"all",81:"all",82:[[4,10]]},z={door:h,otv:h,fire:{2:"all",4:"all",9:"all",26:"all",34:"all",40:"all",41:"all",81:"all"},automatic:{68:"all"},fireFighting:{68:"all"}}[n.type],s=p(()=>C.value?G.value.reduce((r,y)=>{if(!Object.hasOwn(z,y.type))return r;let{typeElements:O}=ce(Re(y.index,"input"));const Z=O.filter(L=>{var le,xe;const se=N.getters["output/inDamperComposition"](L),_e=["automatic","fireFighting"].includes(n.type)?!1:yt(L),be=We(L),re=L.zone_index!==ke,ye=((le=n.formElementByDeviceIndex[y.index])==null?void 0:le.input.includes(L.number))||y.isKDL&&((xe=n.formElementByDeviceIndex[y.index])==null?void 0:xe.output.includes(L.number)),ae=z[y.type],de=ae==="all"||ae.some(ge=>et(L.number,ge[0],ge[1]+1));return!se&&!_e&&!be&&!ye&&!re&&de});return Z.length>0&&(r[y.index]=Z),r},{}):{[m.value.device_index]:j.value.filter(r=>r.uniqueIndex===m.value.uniqueIndex)}),H=p(()=>{let r=[];return C.value?r=Object.keys(s.value).map(y=>Q.value[y]):r=G.value,r.sort((y,O)=>y.address-O.address)}),J=p(()=>H.value.length===0),W=p(()=>C.value?t.value.INPUT_MODAL[n.type].add:t.value.INPUT_MODAL[n.type].edit),ee=p(()=>C.value?o.value.GENERAL.BUTTON.add:o.value.GENERAL.BUTTON.apply);function te(r){const y=s.value[m.value.device_index].find(O=>O.uniqueIndex===r);m.value={...y,contact_id:m.value.contact_id}}function ie(r){const y=s.value[r][0];m.value={...y,contact_id:m.value.contact_id}}function ue(){var r,y;n.modelValue?m.value=ce(n.modelValue):m.value=((y=s.value[(r=H.value[0])==null?void 0:r.index])==null?void 0:y[0])||{}}ue();function ne(){switch(n.type){case"door":m.value.name=t.value.INPUTS_NAME.door;break;case"otv":m.value.name=t.value.INPUTS_NAME.otv;break;case"fire":m.value.name=t.value.INPUTS_NAME.fire;break}}function w(){if(C.value&&k.value===null){d(De);return}switch(C.value&&ne(),m.value.index=m.value.index??k.value,m.value.zone_index=n.zoneIndex,m.value.script_index=we,n.type){case"door":m.value.type=q.auxiliary,m.value.subtype=Ie.door;break;case"otv":m.value.type=q.auxiliary,m.value.subtype=Ie.otv;break;case"fire":m.value.type=q.remoteRelease,m.value.subtype=Ie.untyped;break}at(m.value,n.modelValue)||(m.value.isNew=!0),f(Se(m.value))}const x=p(()=>{const r=[];return r.push({label:o.value.CONFIGURATION.GENERAL.notSetParentheses,value:we}),r.concat(Object.values(l.value[xt.INPUT]).map(y=>({label:y.formattedName,value:y.index,number:y.script_number})).sort((y,O)=>y.number-O.number))}),b=p(()=>{switch(n.type){case"automatic":case"fireFighting":return{script_index:!0};default:return{}}});return(r,y)=>(A(),U(nt,{ref_key:"dialogRef",ref:c,onHide:e(P)},{default:S(()=>[g(e(tt),{title:W.value,closable:"",onClose:e(v),class:"w-full"},{footer:S(()=>{var O,Z;return[g(oe,{label:e(o).GENERAL.BUTTON.reset,onClick:(O=I.value)==null?void 0:O.reset,class:"col text-button fill-input",color:"primary",type:"reset"},null,8,["label","onClick"]),g(oe,{label:ee.value,onClick:(Z=I.value)==null?void 0:Z.submit,class:"col text-button",color:"positive",type:"submit",disable:J.value},null,8,["label","onClick","disable"])]}),default:S(()=>[g(Ge,{onSubmit:w,onReset:ue,ref_key:"qFormRef",ref:I},{default:S(()=>[g(Ae,null,{default:S(()=>[g(pe,{"model-value":m.value.device_index,"onUpdate:modelValue":ie,label:J.value?t.value.INPUT_MODAL.notFound:e(o).GENERAL.LABEL.device,options:H.value,rules:[O=>e($).number().integer().required().validate(O)],disable:!C.value||J.value,"popup-content-class":"b-select-popup",class:"b-field","emit-value":"","map-options":"","option-label":"formattedNameWithType","option-value":"index","data-testid":"device-select"},null,8,["model-value","label","options","rules","disable"]),g(pe,{"model-value":m.value.uniqueIndex,"onUpdate:modelValue":te,label:e(o).GENERAL.LABEL.input,options:s.value[m.value.device_index],rules:[O=>e($).string().required().validate(O)],disable:!C.value||!Object.hasOwn(m.value,"device_index"),"popup-content-class":"b-select-popup",class:"b-field","emit-value":"","map-options":"","data-testid":"input-select","option-label":"fullName","option-value":"uniqueIndex"},null,8,["model-value","label","options","rules","disable"]),g(me,{modelValue:m.value.contact_id,"onUpdate:modelValue":y[0]||(y[0]=O=>m.value.contact_id=O),modelModifiers:{number:!0},min:1,max:999,hint:e(D)("error.range",{min:1,max:999}),rules:[O=>e($).coerce.number().integer().min(1).max(999).validate(O)],type:"number",label:"Contact ID","data-testid":"contact-id-input",class:"b-field"},null,8,["modelValue","hint","rules"]),b.value.script_index?(A(),U(pe,{key:0,modelValue:m.value.script_index,"onUpdate:modelValue":y[1]||(y[1]=O=>m.value.script_index=O),label:e(o).CONFIGURATION.DEVICES.LABEL.script_index,options:x.value,"popup-content-class":"b-select-popup",class:"b-field","emit-value":"","map-options":"","data-testid":"script-index-select"},null,8,["modelValue","label","options"])):F("",!0)]),_:1})]),_:1},512)]),_:1},8,["title","onClose"])]),_:1},8,["onHide"]))}},Qt={__name:"AppOutputDialog",props:{modelValue:{type:[Object,null],default:null},formElementByDeviceIndex:{type:Object,required:!0},type:{type:String,required:!0},zoneIndex:{type:Number,required:!0},formOutputs:{type:Array,required:!0},fireZones:{type:Array,required:!0},otvInputOptions:{type:Array,required:!0},startFire2:{type:Boolean,required:!0}},emits:[...Le.emits],setup(a){const n=a,o=ze(),t=p(()=>o.value.CONFIGURATION.ZONES_PT),{maxElementsToast:d}=je(),{dialogRef:c,onDialogHide:P,onDialogOK:f,onDialogCancel:v}=Le(),I=Ne(null),{t:D}=Me(),N=Fe(),G=p(()=>N.getters["device/deviceArray"]),Q=p(()=>N.getters["device/DEVICE_LIST"]),j=p(()=>N.getters["output/outputArray"]),l=Ne({}),m=p(()=>n.modelValue===null),C=p(()=>Ve([...n.formOutputs,...j.value].map(x=>x.index),Je)),k={2:[[4,5]],4:[[3,4]],9:"all",15:"all",26:[[4,7]],34:[[3,4]],40:"all",41:"all",68:[[1,4]],81:"all",82:[[3,4]]},h=p(()=>m.value?G.value.reduce((x,b)=>{if(!Object.hasOwn(k,b.type))return x;let{typeElements:r}=ce(Re(b.index,"output"));const y=r.filter(O=>{var ae,de;const Z=N.getters["output/inDamperComposition"](O),L=We(O),se=O.zone_index!==ke,_e=b.isKDL&&((ae=n.formElementByDeviceIndex[b.index])==null?void 0:ae.input.includes(O.number)),be=(de=n.formElementByDeviceIndex[b.index])==null?void 0:de.output.includes(O.number),re=k[b.type],ye=re==="all"||re.some(le=>et(O.number,le[0],le[1]+1));return!Z&&!L&&!be&&!_e&&!se&&ye});return y.length>0&&(x[b.index]=y),x},{}):{[l.value.device_index]:j.value.filter(x=>x.uniqueIndex===l.value.uniqueIndex)}),K=p(()=>{let x=[];return m.value?x=Object.keys(h.value).map(b=>Q.value[b]):x=G.value,x.sort((b,r)=>b.address-r.address)}),R=p(()=>K.value.length===0),fe=p(()=>m.value?t.value.OUTPUT_MODAL[n.type].add:t.value.OUTPUT_MODAL[n.type].edit),z=p(()=>m.value?o.value.GENERAL.BUTTON.add:o.value.GENERAL.BUTTON.apply),s=Ne(!1);function H(x){l.value=x,s.value=ut(l.value,n.type)}function J(x){H(Object.assign(x,{contact_id:l.value.contact_id,activate_time:l.value.activate_time,delay1:l.value.delay1,delay2:l.value.delay2,sdu_input_index:l.value.sdu_input_index,sdu_response_time:l.value.sdu_response_time,program_index:l.value.program_index}))}function W(x){const b=h.value[l.value.device_index].find(r=>r.uniqueIndex===x);J(b)}function ee(x){const b=h.value[x][0];J(b)}function te(){var x,b;if(n.modelValue)H(ce(n.modelValue));else{switch(n.type){case"start":l.value.delay1=240,l.value.delay2=120,l.value.activate_time=120;break;case"siren":l.value.delay1=0,l.value.delay2=0,l.value.activate_time=960;break;default:l.value.delay1=0,l.value.delay2=0,l.value.activate_time=0;break}l.value.sdu_input_index=he,l.value.sdu_response_time=0;const r=(b=h.value[(x=K.value[0])==null?void 0:x.index])==null?void 0:b[0];r&&J(r)}}te();function ie(){switch(n.type){case"start":l.value.name=t.value.OUTPUTS_NAME.start;break;case"siren":l.value.name=t.value.OUTPUTS_NAME.siren;break;case"automatic":l.value.name=t.value.OUTPUTS_NAME.automatic;break;case"leave":l.value.name=t.value.OUTPUTS_NAME.leave;break;case"dontComeIn":l.value.name=t.value.OUTPUTS_NAME.dontComeIn;break}}function ue(){if(m.value&&C.value===null){d(Je);return}switch(m.value&&ie(),l.value.index=l.value.index??C.value,l.value.zone_index=n.zoneIndex,l.value.script_index=we,n.type){case"start":l.value.type=M.fireProtection,l.value.related_zones=[...n.fireZones,l.value.zone_index].sort((x,b)=>x-b);break;case"siren":l.value.type=M.simpleRelay,l.value.related_zones=[...n.fireZones,l.value.zone_index].sort((x,b)=>x-b);break;case"automatic":l.value.type=M.simpleRelay,l.value.related_zones=[l.value.zone_index];break;case"leave":l.value.type=M.simpleRelay,l.value.related_zones=[l.value.zone_index];break;case"dontComeIn":l.value.type=M.simpleRelay,l.value.related_zones=[l.value.zone_index];break}at(l.value,n.modelValue)||(l.value.isNew=!0),f(Se(l.value))}Te(s,x=>{it(l.value,n.type,n.startFire2,x)},{immediate:!0});const ne=p(()=>l.value.sdu_input_index===he);Te(ne,x=>{x&&(l.value.sdu_response_time=null)});const w=p(()=>{switch(n.type){case"start":return{contact_id:!0,delay1:!0,delay2:!0,activate_time:!0,sdu_input_index:!0,sdu_response_time:!0};case"siren":return{contact_id:!0,activate_time:!0,intermittent_mode:!0};case"automatic":return{contact_id:!0};case"leave":return{contact_id:!0,intermittent_mode:!0};case"dontComeIn":return{contact_id:!0,intermittent_mode:!0};default:return{}}});return(x,b)=>(A(),U(nt,{ref_key:"dialogRef",ref:c,onHide:e(P)},{default:S(()=>[g(e(tt),{title:fe.value,closable:"",onClose:e(v),class:"w-full"},{footer:S(()=>{var r,y;return[g(oe,{label:e(o).GENERAL.BUTTON.reset,onClick:(r=I.value)==null?void 0:r.reset,class:"col text-button fill-input",color:"primary",type:"reset"},null,8,["label","onClick"]),g(oe,{label:z.value,onClick:(y=I.value)==null?void 0:y.submit,class:"col text-button",color:"positive",type:"submit",disable:R.value},null,8,["label","onClick","disable"])]}),default:S(()=>[g(Ge,{ref_key:"qFormRef",ref:I,onSubmit:ue,onReset:te},{default:S(()=>[g(Ae,null,{default:S(()=>[g(pe,{"model-value":l.value.device_index,"onUpdate:modelValue":ee,label:R.value?t.value.OUTPUT_MODAL.notFound:e(o).GENERAL.LABEL.device,options:K.value,rules:[r=>e($).number().integer().required().validate(r)],disable:!m.value||R.value,"popup-content-class":"b-select-popup",class:"b-field","emit-value":"","map-options":"","option-label":"formattedNameWithType","option-value":"index","data-testid":"device-select"},null,8,["model-value","label","options","rules","disable"]),g(pe,{"model-value":l.value.uniqueIndex,"onUpdate:modelValue":W,label:e(o).GENERAL.LABEL.output,options:h.value[l.value.device_index],rules:[r=>e($).string().required().validate(r)],disable:!m.value||!Object.hasOwn(l.value,"device_index"),"popup-content-class":"b-select-popup",class:"b-field","emit-value":"","map-options":"","data-testid":"output-select","option-label":"fullName","option-value":"uniqueIndex"},null,8,["model-value","label","options","rules","disable"]),w.value.contact_id?(A(),U(me,{key:0,modelValue:l.value.contact_id,"onUpdate:modelValue":b[0]||(b[0]=r=>l.value.contact_id=r),modelModifiers:{number:!0},min:1,max:999,hint:e(D)("error.range",{min:1,max:999}),rules:[r=>e($).coerce.number().integer().min(1).max(999).validate(r)],type:"number",label:"Contact ID","data-testid":"contact-id-input",class:"b-field"},null,8,["modelValue","hint","rules"])):F("",!0),w.value.delay1?(A(),U(Qe,{key:1,modelValue:l.value.delay1,"onUpdate:modelValue":b[1]||(b[1]=r=>l.value.delay1=r),min:e(Ye),max:e($e),step:e(Ue),multiple:e(Ue),label:t.value.LABEL.delay1,"data-testid":"delay1-input",required:""},null,8,["modelValue","min","max","step","multiple","label"])):F("",!0),w.value.delay2?(A(),U(Qe,{key:2,modelValue:l.value.delay2,"onUpdate:modelValue":b[2]||(b[2]=r=>l.value.delay2=r),min:e(Ye),max:e($e),step:e(Ue),multiple:e(Ue),label:t.value.LABEL.delay2,"data-testid":"delay2-input",required:""},null,8,["modelValue","min","max","step","multiple","label"])):F("",!0),w.value.activate_time?(A(),U(Vt,{key:3,modelValue:l.value.activate_time,"onUpdate:modelValue":b[3]||(b[3]=r=>l.value.activate_time=r),label:t.value.LABEL.activate_time,"data-testid":"activate-time"},null,8,["modelValue","label"])):F("",!0),w.value.intermittent_mode?(A(),U(Ee,{key:4,modelValue:s.value,"onUpdate:modelValue":b[4]||(b[4]=r=>s.value=r),label:t.value.LABEL.intermittent_mode,"data-testid":"intermittent-mode-checkbox",class:"b-checkbox","left-label":""},null,8,["modelValue","label"])):F("",!0),w.value.sdu_input_index?(A(),U(pe,{key:5,modelValue:l.value.sdu_input_index,"onUpdate:modelValue":b[5]||(b[5]=r=>l.value.sdu_input_index=r),label:t.value.LABEL.sdu_input_index,options:a.otvInputOptions,"popup-content-class":"b-select-popup",class:"b-field","emit-value":"","map-options":"","data-testid":"sdu-input-index-select"},null,8,["modelValue","label","options"])):F("",!0),w.value.sdu_response_time?(A(),U(me,{key:6,modelValue:l.value.sdu_response_time,"onUpdate:modelValue":b[6]||(b[6]=r=>l.value.sdu_response_time=r),min:0,max:255,label:t.value.LABEL.sdu_response_time+" *",disable:ne.value,hint:e(D)("error.range",{min:0,max:255}),rules:[r=>e($).coerce.number().integer().required({validateIf:!ne.value}).min(0).max(255).validate(r)],type:"number",class:"b-field","data-testid":"sdu-response-time-input"},null,8,["modelValue","label","disable","hint","rules"])):F("",!0)]),_:1})]),_:1},512)]),_:1},8,["title","onClose"])]),_:1},8,["onHide"]))}},Kt={class:"config-form__body"},Wt={class:"config-form__buttons"},en={__name:"AppZonePtForm",props:{elements:{type:Array,default:()=>[]}},emits:["update:elements"],setup(a,{emit:n}){const{confirmEmptyElementDeletion:o,showDeleteDialog:t,confirmEmptyZoneGroupDeletion:d,showDescribedDialog:c,showContinueDialog:P}=Ut(),f=ze(),v=p(()=>f.value.CONFIGURATION.ZONES_PT),{t:I}=Me(),D=It(),N=Fe(),G=p(()=>N.getters["output/outputArray"]),Q=p(()=>N.getters["reader/readerArray"]),j=p(()=>N.getters["zone_group/zoneGroupIndexesIncludedZoneIndex"]),l=p(()=>N.getters["controller/masterControllerIsStandalone"]),m=p(()=>N.getters["zone/ZONE_TREE"]),C=p(()=>N.getters["device/DEVICE_TREE"]),k=p(()=>N.getters["device/DEVICE_LIST"]),h=[15],K=p(()=>C.value.filter(_=>h.includes(_.data.type))),R=a,fe=n,z=p(()=>{const _=Gt(R.elements[0].index),u=Mt(R.elements[0].index).map(X=>X.index),{outputs:i,startFire2:E,fireZones:B}=jt(R.elements[0].index);return{inputs:_,devices:u,outputs:i,startFire2:E,fireZones:B}}),{form:s,formRef:H,deleteButtonRef:J,isSaving:W,isDeleting:ee,isNew:te,mainFormElement:ie,deleteButtonLabel:ue,saveButtonLabel:ne,onReset:w,onSave:x,onDelete:b}=Pt({props:R,saveFn:be,deleteFn:re,resetFn:O}),{nonUniqueZoneNumbers:r,nonUniqueZoneContactIds:y}=ot(s);function O({form:_,mainFormElement:u}){_.value={...ce(u.value),zonePtComposition:ce(z.value)}}const Z=p(()=>Object.values(s.value.zonePtComposition.inputs).flat()),L=p(()=>Object.values(s.value.zonePtComposition.outputs).flat()),se=p(()=>[...L.value,...Z.value].reduce((_,u)=>(_[u.device_index]=_[u.device_index]||{input:[],output:[]},_[u.device_index][u.elementType].push(u.number),_),{}));async function _e(){const _=s.value.zonePtComposition.inputs.otv,u=L.value.map(Y=>Y.sdu_input_index),i=_.filter(Y=>u.includes(Y.index)),E=_.filter(Y=>!u.includes(Y.index));if(E.length===0)return!0;const{title:B,subtitle:X}=v.value.SAVE_MODAL;return await c(P,B,X,E)?(s.value.zonePtComposition.inputs.otv=i,!0):!1}async function be(){if(!await _e())return;const _=Se(s.value),u=[...Object.values(_.zonePtComposition.inputs).flat()],i=u.map(T=>T.index),E=[...Object.values(_.zonePtComposition.outputs).flat()],B=E.map(T=>T.index),X=_.zonePtComposition.devices.map(T=>({...k.value[T],zone_index:_.index})),Y=X.map(T=>T.index),V=Object.values(z.value.inputs).flat(),st=Object.values(z.value.outputs).flat(),rt=z.value.devices.map(T=>k.value[T]),dt=[...V.filter(T=>!i.includes(T.index)),...st.filter(T=>!B.includes(T.index))],pt=rt.filter(T=>!Y.includes(T.index)).map(T=>({...T,zone_index:ke}));return W.value=!0,await N.dispatch("config/saveElement",{elementList:[_,...u,...E,...X,...pt].map(T=>(delete T.isNew,{data:T,type:T.elementType})),stash:!0}),await N.dispatch("config/deleteElement",{elementList:dt.map(T=>({index:T.index,type:T.elementType}))}),fe("update:elements",[_]),!0}async function re(){const _=s.value.index;if(!await t(v.value.DELETE_MODAL.title,v.value.DELETE_MODAL.content))return;ee.value=!0;const u=j.value[_]||[],i=G.value.filter(V=>V.related_zonegroups.includes(_)).map(V=>V.index),E=Q.value.filter(V=>V.allowed_zonegroups.includes(_)).map(V=>V.index),B=Object.values(z.value.inputs).flat(),X=Object.values(z.value.outputs).flat(),Y=z.value.devices.map(V=>k.value[V]);return await N.dispatch("config/deleteElement",{elementList:[s.value,...B,...X].map(V=>({index:V.index,type:V.elementType})),stash:!0}),await N.dispatch("config/saveElement",{elementList:Y.map(V=>({data:{...V,zone_index:ke},type:"device"})),stash:!0}),await N.dispatch("config/integrityCheck"),await d(u),await o(i,E,"zone"),await N.dispatch("config/integrityCheck"),!0}Te(()=>s.value.zonePtComposition.startFire2,_=>{Object.entries(s.value.zonePtComposition.outputs).forEach(([u,i])=>i.forEach(E=>it(E,u,_)))});const ye=p(()=>{const _=[];return _.push({label:f.value.CONFIGURATION.GENERAL.notSetParentheses,value:he}),_.concat(s.value.zonePtComposition.inputs.otv.map(u=>({...u,label:u.fullName,value:u.index})).sort(lt))});Te(()=>s.value.zonePtComposition.inputs.otv,_=>{s.value.zonePtComposition.outputs.start.forEach(u=>{_.findIndex(E=>E.index===u.sdu_input_index)===-1&&(u.sdu_input_index=he,u.sdu_response_time=0)})}),Te(()=>s.value.zonePtComposition.fireZones,_=>{s.value.zonePtComposition.outputs.start.forEach(u=>u.related_zones=[..._,s.value.index].sort((i,E)=>i-E)),s.value.zonePtComposition.outputs.siren.forEach(u=>u.related_zones=[..._,s.value.index].sort((i,E)=>i-E))});const ae=p(()=>m.value.filter(_=>_.data.index!==s.value.index&&_.data.type===gt.default)),de=p(()=>[{type:"fire",label:v.value.INPUTS_TYPE.fire,required:!0,readonly:!1},{type:"door",label:v.value.INPUTS_TYPE.door,readonly:!1},{type:"otv",label:v.value.INPUTS_TYPE.otv,readonly:!1,hint:v.value.HINT.requiredRelationsOtv},{type:"automatic",label:v.value.INPUTS_TYPE.automatic,readonly:!0},{type:"fireFighting",label:v.value.INPUTS_TYPE.fireFighting,readonly:!0}]),le=p(()=>[{type:"start",label:v.value.OUTPUTS_NAME.start,readonly:!1,required:!0},{type:"siren",label:v.value.OUTPUTS_NAME.siren,readonly:!1},{type:"automatic",label:v.value.OUTPUTS_NAME.automatic,readonly:!1},{type:"leave",label:v.value.OUTPUTS_NAME.leave,readonly:!1},{type:"dontComeIn",label:v.value.OUTPUTS_NAME.dontComeIn,readonly:!1}]);async function xe(_,u){const i=await new Promise(E=>{D.create({component:Xt,componentProps:{modelValue:u,formElementByDeviceIndex:se.value,formInputs:Z.value,zoneIndex:s.value.index,type:_}}).onOk(B=>{E(B)}).onDismiss(()=>{E()})});i&&(u?Object.assign(u,i):s.value.zonePtComposition.inputs[_].push(i))}async function ge(_,u){const i=await new Promise(E=>{D.create({component:Qt,componentProps:{modelValue:u,formElementByDeviceIndex:se.value,formOutputs:L.value,zoneIndex:s.value.index,otvInputOptions:ye.value,fireZones:s.value.zonePtComposition.fireZones,startFire2:s.value.zonePtComposition.startFire2,type:_}}).onOk(B=>{E(B)}).onDismiss(()=>{E()})});i&&(u?Object.assign(u,i):s.value.zonePtComposition.outputs[_].push(i))}return(_,u)=>(A(),U(Ge,{class:"config-form",ref_key:"formRef",ref:H,onSubmit:e(x),onReset:e(w)},{default:S(()=>[Oe("div",Kt,[g(Ct,{title:e(ie).filledName,marker:e(ie).number,"onUpdate:elements":u[0]||(u[0]=i=>fe("update:elements",i))},null,8,["title","marker"]),g(Pe,{label:e(f).CONFIGURATION.DEVICES.mainSettings},{default:S(()=>[g(Ae,null,{default:S(()=>[g(me,{modelValue:e(s).name,"onUpdate:modelValue":u[1]||(u[1]=i=>e(s).name=i),modelModifiers:{trim:!0},"data-testid":"name-input",label:e(f).GENERAL.LABEL.name,rules:e(Et),maxlength:"31",class:"b-field"},null,8,["modelValue","label","rules"]),g(me,{modelValue:e(s).number,"onUpdate:modelValue":u[2]||(u[2]=i=>e(s).number=i),modelModifiers:{number:!0},min:1,max:65535,label:e(f).GENERAL.LABEL.number+" *",class:"b-field",type:"number",hint:e(I)("error.range",{min:1,max:65535}),rules:[i=>e($).coerce.number().min(1).max(65535).notIn(e(r)).required().validate(i)],"data-testid":"number-input"},null,8,["modelValue","label","hint","rules"]),g(me,{modelValue:e(s).contact_id,"onUpdate:modelValue":u[3]||(u[3]=i=>e(s).contact_id=i),modelModifiers:{number:!0},min:1,max:99,hint:e(I)("error.range",{min:1,max:99}),rules:[i=>e($).coerce.number().integer().min(1).max(99).notIn(e(y)).validate(i)],type:"number",label:"Contact ID","data-testid":"contact-id-input",class:"b-field"},null,8,["modelValue","hint","rules"]),Oe("div",null,[l.value?F("",!0):(A(),U(Ee,{key:0,modelValue:e(s).is_interpanel,"onUpdate:modelValue":u[4]||(u[4]=i=>e(s).is_interpanel=i),label:e(f).CONFIGURATION.ZONE_GROUPS.LABEL.is_interpanel,"data-testid":"is-interpanel-checkbox",class:"b-checkbox","left-label":""},null,8,["modelValue","label"])),g(Ee,{modelValue:e(s).zonePtComposition.startFire2,"onUpdate:modelValue":u[5]||(u[5]=i=>e(s).zonePtComposition.startFire2=i),label:v.value.LABEL.startFire2,"data-testid":"start-fire-2-checkbox",class:"b-checkbox","left-label":""},null,8,["modelValue","label"]),g(Ee,{modelValue:e(s).auto_recover,"onUpdate:modelValue":u[6]||(u[6]=i=>e(s).auto_recover=i),label:v.value.LABEL.auto_recover,"data-testid":"auto-recover-checkbox",class:"b-checkbox","left-label":""},null,8,["modelValue","label"]),g(Ee,{modelValue:e(s).start_recover,"onUpdate:modelValue":u[7]||(u[7]=i=>e(s).start_recover=i),label:v.value.LABEL.start_recover,"data-testid":"start-recover-checkbox",class:"b-checkbox","left-label":""},null,8,["modelValue","label"])]),g(e(qe),{modelValue:e(s).zonePtComposition.fireZones,"onUpdate:modelValue":u[8]||(u[8]=i=>e(s).zonePtComposition.fireZones=i),items:ae.value,label:v.value.LABEL.fireZones,type:"zone","data-testid":"fire-zones-dnd","data-key":"index",itemMarker:"extendedMarker",required:""},null,8,["modelValue","items","label"])]),_:1})]),_:1},8,["label"]),g(Pe,{label:e(f).CONFIGURATION.GENERAL.TYPES.output},{default:S(()=>[g(Ae,null,{default:S(()=>[(A(!0),Ce(Be,null,He(le.value,i=>(A(),U(Ke,Xe({key:i.type,ref_for:!0},i,{modelValue:e(s).zonePtComposition.outputs[i.type],"onUpdate:modelValue":E=>e(s).zonePtComposition.outputs[i.type]=E,"data-testid":`zone-items__output-${i.type}`,onAdd:E=>ge(i.type),onEditItem:E=>ge(i.type,E)}),null,16,["modelValue","onUpdate:modelValue","data-testid","onAdd","onEditItem"]))),128))]),_:1})]),_:1},8,["label"]),g(Pe,{label:e(f).CONFIGURATION.GENERAL.TYPES.input},{default:S(()=>[g(Ae,null,{default:S(()=>[(A(!0),Ce(Be,null,He(de.value,i=>(A(),U(Ke,Xe({key:i.type,ref_for:!0},i,{modelValue:e(s).zonePtComposition.inputs[i.type],"onUpdate:modelValue":E=>e(s).zonePtComposition.inputs[i.type]=E,"data-testid":`zone-items__input-${i.type}`,onAdd:E=>xe(i.type),onEditItem:E=>xe(i.type,E)}),null,16,["modelValue","onUpdate:modelValue","data-testid","onAdd","onEditItem"]))),128))]),_:1})]),_:1},8,["label"]),g(Pe,{label:e(f).ROUTER.CONFIG.devices},{default:S(()=>[g(e(qe),{modelValue:e(s).zonePtComposition.devices,"onUpdate:modelValue":u[9]||(u[9]=i=>e(s).zonePtComposition.devices=i),items:K.value,label:e(f).ROUTER.CONFIG.devices,type:"zone","data-testid":"zone-devices-dnd","data-key":"index",itemMarker:"extendedMarker",hint:v.value.HINT.onlyS2000Kpb},null,8,["modelValue","items","label","hint"])]),_:1},8,["label"])]),Oe("div",Wt,[e(te)?F("",!0):(A(),U(oe,{key:0,label:e(f).GENERAL.BUTTON.reset,class:"text-button fill-input",type:"reset","data-testid":"form-reset-btn"},null,8,["label"])),e(te)?F("",!0):(A(),U(oe,{key:1,ref_key:"deleteButtonRef",ref:J,label:e(ue),loading:e(ee),disable:e(W),class:"text-button",color:"negative","data-testid":"form-delete-btn",onClick:e(b)},null,8,["label","loading","disable","onClick"])),g(oe,{loading:e(W),label:e(ne),disable:e(ee),class:"text-button","data-testid":"form-save-btn",color:"positive",type:"submit"},null,8,["loading","label","disable"])])]),_:1},8,["onSubmit","onReset"]))}},cn={__name:"AppZonesPtPage",setup(a){const{freeZoneIndex:n,freeZoneNumber:o,MAX_COUNT_ZONES:t,zoneArray:d}=ot(),{maxElementsToast:c}=je(),P=ze(),f=Fe(),v=p(()=>f.getters["zone/ZONE_TREE"].filter(C=>C.data.isZonePt)),{formId:I,leftTreeRef:D,selectedElements:N,selectedTreeItemIds:G,selectNewTreeItemIds:Q,updateSelectedElements:j,onAdd:l}=Ot({leftTree:v,rightTree:[],add:m});function m(){if(d.value.length>=t){c(t);return}let{typeElements:C}=Re(0,"input");const k=C.filter(R=>R.number>0&&R.index===null),h=Math.floor((C.length-1)/2);if(k.length<2){c(h);return}return Tt({...At("zone"),number:o.value,index:n.value,type:2})}return(C,k)=>(A(),Ce(Be,null,[g(e(St),{ref_key:"leftTreeRef",ref:D,selected:e(G),"onUpdate:selected":e(Q),onAdd:e(l),items:v.value,title:e(P).ROUTER.CONFIG.zonesPt,"add-button":"","required-selection":"",searchable:""},null,8,["selected","onUpdate:selected","onAdd","items","title"]),e(N).length?(A(),U(Nt,{key:0,name:"fade",mode:"out-in"},{default:S(()=>[(A(),Ce("div",{class:"config-form-wrapper",key:e(I)},[g(en,{elements:e(N),"onUpdate:elements":e(j)},null,8,["elements","onUpdate:elements"])]))]),_:1})):F("",!0)],64))}};export{cn as default};
