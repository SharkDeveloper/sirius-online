import{u as pe,a as ee,c as o,i as fe,b as te,d as be,M as X,E as _,o as p,e as N,w as $,f as K,g as r,h as e,Q as ve,_ as L,j as F,v as H,k as Ee,l as P,F as le,m as x,n as q,p as ge,q as _e,r as J,s as Te,t as Ae,T as Le,x as j,y as Ne,z as Re,A as Ce}from"./app-X261GMLD.js";import{_ as ye,A as Oe,a as W}from"./AppConfigFormHeader-CpKOoRvu.js";import{_ as Ie,a as Se,b as xe}from"./AppChannelForm-gd4iHyJV.js";import{u as Ve,g as Z,a as ze}from"./useConfigForm-Dwead9lM.js";import{g as Ue}from"./getUpdatedElement-DO3HsR5I.js";import{A as Y}from"./AppDragAndDropArea-Cr3Xjs1I.js";import{_ as De,a as ke}from"./AppMacInput-Cg7qsIbn.js";import{u as he}from"./useConfigDialog-CoOncFYH.js";const we={class:"config-form__body"},Be={class:"config-form__buttons"},Ge={__name:"AppControllerForm",props:{elements:{type:Array,default:()=>[]}},emits:["update:elements"],setup(Q,{emit:V}){const{t:m}=pe(),s=ee(),c=o(()=>s.value.CONFIGURATION.CONTROLLERS),T=fe("rightTree"),v=Q,R=V,{form:a,formRef:z,deleteButtonRef:C,isSaving:E,onSave:U,isDeleting:A,onDelete:D,isNew:y,mainFormElement:f,deleteButtonLabel:g,saveButtonLabel:k,onReset:O}=Ve({props:v,saveFn:me,deleteFn:ce,resetFn:ne}),i=te(),{showDeleteDialog:I,showDescribedDialog:S,showContinueDialog:b}=he(),u=o(()=>i.getters["controller/CONTROLLER_LIST"]),h=o(()=>i.getters["controller/controllerArray"]),w=o(()=>i.getters["controller/masterController"]),ae=o(()=>i.getters["zone/ZONE_LIST"]);function ne({form:n,mainFormElement:t}){n.value=be(t.value)}const d=o(()=>f.value.index===X),oe=o(()=>!d.value&&w.value.interpanel_mode==_.master),se=o(()=>{let n=Object.entries(s.value.SETTINGS.RS485.INTERPANEL_MODE).map(([t,l])=>({label:l,value:Number(t)}));return d.value||(n=n.filter(t=>t.value!==_.standalone)),re.value&&f.value.interpanel_mode!==_.master&&(n=n.filter(t=>t.value!==_.master)),n}),re=o(()=>{for(const n of Object.values(u.value))if(n.interpanel_mode==_.master)return!0;return!1}),ie=o(()=>Z(h.value,"address",a.value.index)),de=o(()=>Z(h.value,"mac",a.value.index).filter(n=>n!=="00:00:00:00:00:00"&&n!=="00-00-00-00-00-00")),ue=o(()=>Z(h.value,"contact_id",a.value.index));async function me(){const n=Ue(a.value),l=n.interpanel_mode===_.standalone&&n.interpanel_mode!==w.value.interpanel_mode&&d.value&&Object.values(u.value).length>1,B=s.value.SETTINGS.RS485.INTERPANEL_MODE[5],G=s.value.SETTINGS.RS485.SAVE_DIALOG.body;return l&&!await b(B,G)?void 0:(E.value=!0,await i.dispatch("config/saveElement",{data:n,type:"controller"}),n.address!==w.value.address&&i.dispatch("controller/updateControllerElements"),l&&(await i.dispatch("config/deleteElement",{elementList:Object.values(u.value).filter(M=>M.index!==X).map(M=>({index:M.index,type:"controller"})),stash:!0}),await i.dispatch("config/integrityCheck")),R("update:elements",[n]),!0)}async function ce(){const n=a.value.index,t=Object.values(ae.value).filter(G=>G.controller_index===n),{TITLE:l,CONTENT:B}=c.value.DELETE_DIALOG;if(await S(I,l,B,t))return A.value=!0,await i.dispatch("config/deleteElement",{index:n,type:"controller",stash:!0}),await i.dispatch("config/integrityCheck"),!0}return(n,t)=>(p(),N(ge,{class:"config-form",ref_key:"formRef",ref:z,onSubmit:e(U),onReset:e(O)},{default:$(()=>[K("div",we,[r(ye,{title:e(f).filledName,marker:e(f).uniqueIndex,"onUpdate:elements":t[0]||(t[0]=l=>R("update:elements",l))},null,8,["title","marker"]),r(Oe,{label:e(s).CONFIGURATION.DEVICES.mainSettings},{default:$(()=>[r(ve,{modelValue:e(a).interpanel_mode,"onUpdate:modelValue":t[1]||(t[1]=l=>e(a).interpanel_mode=l),label:c.value.LABEL.interpanel_mode,options:se.value,disable:d.value&&!e(L),"popup-content-class":"b-select-popup",class:"b-field","emit-value":"","map-options":"","data-testid":"interpanel-mode-select"},null,8,["modelValue","label","options","disable"]),r(F,{modelValue:e(a).address,"onUpdate:modelValue":t[2]||(t[2]=l=>e(a).address=l),modelModifiers:{number:!0},"data-testid":"address-input",min:1,max:32,label:e(s).GENERAL.LABEL.address+" *",disable:d.value&&!e(L),class:"b-field",type:"number",hint:e(m)("error.range",{min:1,max:32}),rules:[l=>e(H).coerce.number().integer().min(1).max(32).notIn(ie.value).required().validate(l)]},null,8,["modelValue","label","disable","hint","rules"]),r(F,{modelValue:e(a).name,"onUpdate:modelValue":t[3]||(t[3]=l=>e(a).name=l),modelModifiers:{trim:!0},"data-testid":"name-input",label:e(s).GENERAL.LABEL.name,rules:e(Ee),disable:d.value&&!e(L),maxlength:"31",class:"b-field"},null,8,["modelValue","label","rules","disable"]),r(De,{modelValue:e(a).mac,"onUpdate:modelValue":t[4]||(t[4]=l=>e(a).mac=l),label:e(s).SETTINGS.MAIN.LABEL.mac+" *",disable:d.value,nonUniqueValues:de.value,class:"b-field"},null,8,["modelValue","label","disable","nonUniqueValues"]),r(ke,{modelValue:e(a).ip,"onUpdate:modelValue":t[5]||(t[5]=l=>e(a).ip=l),label:c.value.LABEL.ip,disable:d.value&&!e(L),zeroth:"",multicast:"",nullable:"",class:"b-field"},null,8,["modelValue","label","disable"]),r(Ie,{modelValue:e(a).zone_index,"onUpdate:modelValue":t[6]||(t[6]=l=>e(a).zone_index=l),label:e(s).GENERAL.LABEL.zone,"popup-content-class":"b-select-popup",class:"b-field","exclude-alien-zones":""},null,8,["modelValue","label"]),r(F,{modelValue:e(a).contact_id,"onUpdate:modelValue":t[7]||(t[7]=l=>e(a).contact_id=l),modelModifiers:{number:!0},min:1,max:999,hint:e(m)("error.range",{min:1,max:999}),rules:[l=>e(H).coerce.number().integer().min(1).max(999).notIn(ue.value).validate(l)],disable:d.value&&!e(L),type:"number",label:"Contact ID","data-testid":"contact-id-input",class:"b-field"},null,8,["modelValue","hint","rules","disable"]),oe.value?(p(),P(le,{key:0},[r(e(Y),{modelValue:e(a).translate_zones,"onUpdate:modelValue":t[8]||(t[8]=l=>e(a).translate_zones=l),label:c.value.LABEL.translate_zones,items:e(T),"data-key":"index",type:"zone",itemMarker:"extendedMarker","data-testid":"translate-zones-dnd"},null,8,["modelValue","label","items"]),r(e(Y),{modelValue:e(a).translate_zonegroups,"onUpdate:modelValue":t[9]||(t[9]=l=>e(a).translate_zonegroups=l),label:c.value.LABEL.translate_zonegroups,items:e(T),"data-key":"index",type:"zone_group",itemMarker:"extendedMarker","data-testid":"translate-zonegroups-dnd"},null,8,["modelValue","label","items"])],64)):x("",!0)]),_:1},8,["label"])]),K("div",Be,[e(y)?x("",!0):(p(),N(q,{key:0,label:e(s).GENERAL.BUTTON.reset,class:"text-button fill-input",type:"reset","data-testid":"form-reset-btn"},null,8,["label"])),!e(y)&&!d.value?(p(),N(q,{key:1,ref_key:"deleteButtonRef",ref:C,label:e(g),loading:e(A),disable:e(E),class:"text-button",color:"negative","data-testid":"form-delete-btn",onClick:e(D)},null,8,["label","loading","disable","onClick"])):x("",!0),r(q,{loading:e(E),label:e(k),disable:e(A),class:"text-button","data-testid":"form-save-btn",color:"positive",type:"submit"},null,8,["loading","label","disable"])])]),_:1},8,["onSubmit","onReset"]))}},Ke={__name:"AppControllersPage",setup(Q){const{maxElementsToast:V}=ze(),m=ee(),s=te(),c=o(()=>s.getters["controller/CONTROLLER_TREE"]),T=o(()=>({zone:v.value?s.getters["zone/TRANSLATE_ZONE_TREE"]:s.getters["zone/ZONE_TREE"],zone_group:v.value?s.getters["zone_group/TRANSLATE_ZONE_GROUP_TREE"]:s.getters["zone_group/ZONE_GROUP_TREE"]})),v=o(()=>C.value==="controller"),R=o(()=>s.getters["controller/masterControllerIsStandalone"]),{formId:a,leftTreeRef:z,mainFormElementType:C,selectedElements:E,selectedTreeItemIds:U,selectNewTreeItemIds:A,updateSelectedElements:D,onAdd:y}=_e({leftTree:c,rightTree:T,add:i}),f=o(()=>[{name:"zone",label:v.value?m.value.GENERAL.LABEL.translate_zones:m.value.GENERAL.LABEL.zones},{name:"zone_group",label:v.value?m.value.GENERAL.LABEL.translate_zoneGroups:m.value.GENERAL.LABEL.zoneGroups}]),g=J();Te(()=>{g.value=f.value[0].name});const k=o(()=>{switch(C.value){case"channel":return xe;case"reader":return Se;default:return Ge}}),O=o(()=>s.getters["controller/controllerArray"]);function i(){if(O.value.length>=j){V(j);return}const S=Ne(O.value.map(u=>u.address),j+1,1);return Re({...Ce("controller"),address:S,index:null})}const I=J([]);return(S,b)=>(p(),P(le,null,[r(e(W),{ref_key:"leftTreeRef",ref:z,selected:e(U),"onUpdate:selected":e(A),onAdd:e(y),items:c.value,title:e(m).ROUTER.CONFIG.controllers,"add-button":!R.value,"required-selection":"",searchable:""},null,8,["selected","onUpdate:selected","onAdd","items","title","add-button"]),e(E).length?(p(),N(Le,{key:0,name:"fade",mode:"out-in"},{default:$(()=>[(p(),P("div",{class:"config-form-wrapper",key:e(a)},[(p(),N(Ae(k.value),{elements:e(E),"onUpdate:elements":e(D)},null,40,["elements","onUpdate:elements"]))]))]),_:1})):x("",!0),r(e(W),{tab:g.value,"onUpdate:tab":b[0]||(b[0]=u=>g.value=u),selected:I.value,"onUpdate:selected":b[1]||(b[1]=u=>I.value=u),items:T.value[g.value],tabs:f.value,"is-right-tree":"","can-multiple-selection":"","can-selection-all-children":"",searchable:""},null,8,["tab","selected","items","tabs"])],64))}};export{Ke as default};
