import{av as de,a as $,u as ce,b as j,c as r,r as Q,aa as me,d as pe,bA as fe,P as W,v as S,bB as ve,bC as be,o as i,e as T,w as A,f as d,g as o,h as e,j as G,bD as _e,Q as ge,ag as X,l as R,F as Y,aF as Te,n as p,bo as Ae,af as Ne,_ as Ee,m as U,aC as we,aB as Ie,bE as Oe,bF as Se,bG as Ue,p as Re,bH as ye,q as xe,y as Pe,bI as k,T as Ce,bJ as De,A as Fe}from"./app-X261GMLD.js";import{_ as he,A as Le,a as Ge}from"./AppConfigFormHeader-CpKOoRvu.js";import{u as ke,g as B,a as Be}from"./useConfigForm-Dwead9lM.js";import{u as Ve}from"./useConfigDialog-CoOncFYH.js";import{g as qe}from"./getUpdatedElement-DO3HsR5I.js";const Me={class:"config-form__body"},He={class:"row justify-between items-center gap-8"},Ke={class:"text-h2",for:"password"},Qe={class:"row gap-8"},We={class:"row no-wrap gap-10"},Xe={key:0},$e={class:"config-form__buttons"},je={class:"text-h1 pt-16 text-center px-8"},Ye=12,ze=16,Je=300,Ze={__name:"AppUserForm",props:{elements:{type:Array,default:()=>[]}},emits:["update:elements"],setup(V,{emit:y}){const{showDeleteDialog:x,showOkDialog:f}=Ve(),n=$(),{t:v}=ce(),N=V,E=y,{form:t,formRef:w,deleteButtonRef:P,isSaving:b,onSave:C,isDeleting:_,onDelete:D,isNew:I,mainFormElement:u,deleteButtonLabel:O,saveButtonLabel:z,onReset:J}=ke({props:N,saveFn:le,deleteFn:oe,resetFn:ae}),c=j(),F=r(()=>c.getters["user/userArray"]),Z=r(()=>c.getters["access_group/accessGroupArray"]),q=r(()=>{var s,l;return((l=(s=c.getters["setting/SETTINGS_LIST"])==null?void 0:s[0])==null?void 0:l.pin_code_maxlen)||Ye}),m=Q(!1);async function ee(){try{m.value=!0;const s=await new Promise(l=>{const a=async()=>{if(!m.value){l("");return}const L=await ye();L.data[0]?l(L.data[0]):setTimeout(a,Je)};a()});t.value.tmPassword=s}catch(s){console.error(s)}finally{m.value=!1}}me(()=>{m.value=!1});const se=r(()=>Z.value.map(s=>({value:s.index,label:s.name})).sort((s,l)=>s.label.localeCompare(l.label)));function ae({form:s,mainFormElement:l}){s.value=pe(l.value)}const g=r(()=>t.value.passwordType==="01"),te=r(()=>g.value?t.value.tmPassword:fe(t.value.pinPassword));W(()=>te.value,s=>{t.value.password=s});async function le(){const s=qe(t.value);return b.value=!0,await c.dispatch("config/saveElement",{data:s,type:"user"}),E("update:elements",[s]),!0}const ne=r(()=>c.getters["user/usersWithConfigureAccess"]),re=r(()=>ne.value.filter(s=>s.index!==u.value.index).length);async function oe(){const s=t.value.index;if(re.value)return await x(n.value.CONFIGURATION.USERS.DELETE_DIALOG.title)?(_.value=!0,await c.dispatch("config/deleteElement",{index:s,type:"user"}),!0):void 0;f(n.value.CONFIGURATION.USERS.CANNOT_DELETE_DIALOG.title,n.value.CONFIGURATION.USERS.requiredUser)}const ue=r(()=>B(F.value,"number",u.value.index)),M=r(()=>B(F.value,"tmPassword",u.value.index)),H=r(()=>B(F.value,"pinPassword",u.value.index)),ie=r(()=>g.value?{label:n.value.CONFIGURATION.USERS.HANDBOOKS.TYPE_PASSWORD_OPTIONS[0].label+" *",maxlength:ze,notIn:M.value,hint:n.value.CONFIGURATION.USERS.ADDITIONAL_HINT.tmPasswordFormat,rules:[s=>S.string().hex().notIn(M.value).required().validate(s),s=>ve(s)||n.value.CONFIGURATION.USERS.ADDITIONAL_HINT.invalidTmPasswordFormat]}:{label:n.value.CONFIGURATION.USERS.HANDBOOKS.TYPE_PASSWORD_OPTIONS[1].label+" *",maxlength:q.value,notIn:H.value,hint:v("error.maxLength",{maxLength:q.value}),rules:[s=>S.string().numeric().notIn(H.value).required().validate(s)]}),h=Q(null),K=r({get(){var s;return g.value?(s=t.value.tmPassword)==null?void 0:s.toUpperCase():t.value.pinPassword},set(s){g.value?t.value.tmPassword=s:t.value.pinPassword=s}});return W(g,()=>{be(()=>{h.value&&h.value.resetValidation()})}),(s,l)=>(i(),T(Re,{class:"config-form",ref_key:"formRef",ref:w,onSubmit:e(C),onReset:e(J)},{default:A(()=>[d("div",Me,[o(he,{title:e(u).filledName,marker:e(u).number,"onUpdate:elements":l[0]||(l[0]=a=>E("update:elements",a))},null,8,["title","marker"]),o(Le,{label:e(n).CONFIGURATION.DEVICES.mainSettings},{default:A(()=>[o(G,{modelValue:e(t).number,"onUpdate:modelValue":l[1]||(l[1]=a=>e(t).number=a),modelModifiers:{number:!0},min:1,max:9999,label:e(n).GENERAL.LABEL.number+" *",hint:e(v)("error.range",{min:1,max:9999}),rules:[a=>e(S).coerce.number().integer().min(1).max(9999).notIn(ue.value).required().validate(a)],class:"b-field",type:"number","data-testid":"number-input"},null,8,["modelValue","label","hint","rules"]),o(G,{modelValue:e(t).name,"onUpdate:modelValue":l[2]||(l[2]=a=>e(t).name=a),modelModifiers:{trim:!0},label:e(n).GENERAL.LABEL.name+" *",rules:[a=>e(S).string().required().minLength(4).maxLength(31).regex(e(_e)).validate(a)],maxlength:"31",class:"b-field","data-testid":"name-input",required:""},null,8,["modelValue","label","rules"]),o(ge,{modelValue:e(t).access_group_index,"onUpdate:modelValue":l[3]||(l[3]=a=>e(t).access_group_index=a),options:se.value,label:e(n).CONFIGURATION.USERS.LABEL.access_group_index,"emit-value":"","map-options":"","data-testid":"access-group-select","popup-content-class":"b-select-popup",class:"b-field"},null,8,["modelValue","options","label"]),d("div",He,[d("label",Ke,X(e(n).CONFIGURATION.USERS.LABEL.password),1),d("div",Qe,[(i(!0),R(Y,null,Te(e(n).CONFIGURATION.USERS.HANDBOOKS.TYPE_PASSWORD_OPTIONS,a=>(i(),T(p,{key:a.value,label:a.label,"data-testid":`password-${a.value}-btn`,onClick:L=>e(t).passwordType=a.value,class:Ae([{"password-type-btn--active":e(t).passwordType===a.value},"password-type-btn"]),rounded:"",unelevated:"",outline:""},null,8,["label","data-testid","onClick","class"]))),128))])]),d("div",We,[o(G,Ne({ref_key:"formPasswordInput",ref:h,id:"password",modelValue:K.value,"onUpdate:modelValue":l[4]||(l[4]=a=>K.value=a)},ie.value,{type:"text","data-testid":"password-input",class:"b-field col",autocomplete:"off",required:""}),null,16,["modelValue"]),!e(Ee)&&e(t).passwordType=="01"?(i(),R("div",Xe,[o(p,{label:e(n).CONFIGURATION.USERS.BUTTONS.READ_PASSWORD,onClick:ee,class:"text-button bg-back text-primary",style:{height:"56px"},"data-testid":"password-read-btn",padding:"4px 20px"},null,8,["label"])])):U("",!0)])]),_:1},8,["label"])]),d("div",$e,[e(I)?U("",!0):(i(),T(p,{key:0,label:e(n).GENERAL.BUTTON.reset,class:"text-button fill-input",type:"reset","data-testid":"form-reset-btn"},null,8,["label"])),e(I)?U("",!0):(i(),T(p,{key:1,ref_key:"deleteButtonRef",ref:P,label:e(O),loading:e(_),disable:e(b),class:"text-button",color:"negative","data-testid":"form-delete-btn",onClick:e(D)},null,8,["label","loading","disable","onClick"])),o(p,{loading:e(b),label:e(z),disable:e(_),class:"text-button","data-testid":"form-save-btn",color:"positive",type:"submit"},null,8,["loading","label","disable"])]),o(we,{modelValue:m.value,"onUpdate:modelValue":l[5]||(l[5]=a=>m.value=a)},{default:A(()=>[o(e(Ie),{class:"column gap-26"},{default:A(()=>[d("span",je,X(e(n).CONFIGURATION.USERS.attachKey),1),o(Oe,{color:"primary",indeterminate:"",rounded:"",size:"80px",class:"mx-auto px-0 py-0"}),Se(o(p,{label:e(n).GENERAL.BUTTON.cancel,class:"fill-input text-button","data-testid":"password-read-cancel-btn"},null,8,["label"]),[[Ue]])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["onSubmit","onReset"]))}},es=de(Ze,[["__scopeId","data-v-20239071"]]),rs={__name:"AppUsersPage",setup(V){const y=$(),{maxElementsToast:x}=Be(),f=j(),n=r(()=>f.getters["access_group/accessGroupArray"]),v=r(()=>f.getters["user/userArray"]),N=r(()=>f.getters["user/USER_TREE"]),{formId:E,leftTreeRef:t,selectedElements:w,selectedTreeItemIds:P,selectNewTreeItemIds:b,updateSelectedElements:C,onAdd:_}=xe({leftTree:N,rightTree:[],add:I}),D=r(()=>{const u=v.value.map(O=>O.number);return Pe(u,k+1,1)});function I(){if(v.value.length>=k){x(k);return}return De({...Fe("user"),access_group_index:n.value[0].index,number:D.value,index:null,tmPassword:"",pinPassword:"",passwordType:"01"})}return(u,O)=>(i(),R(Y,null,[o(e(Ge),{ref_key:"leftTreeRef",ref:t,selected:e(P),"onUpdate:selected":e(b),onAdd:e(_),items:N.value,title:e(y).ROUTER.CONFIG.users,"required-selection":"",searchable:"","add-button":""},null,8,["selected","onUpdate:selected","onAdd","items","title"]),e(w).length?(i(),T(Ce,{key:0,name:"fade",mode:"out-in"},{default:A(()=>[(i(),R("div",{class:"config-form-wrapper",key:e(E)},[o(e(es),{elements:e(w),"onUpdate:elements":e(C)},null,8,["elements","onUpdate:elements"])]))]),_:1})):U("",!0)],64))}};export{rs as default};
