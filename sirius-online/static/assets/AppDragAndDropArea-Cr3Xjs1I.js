import{bl as P,bm as pe,bn as me,c as u,o as s,e as i,w as y,l as T,f as C,ag as F,m as g,aw as be,bo as Y,h as S,bp as ge,n as N,bq as ye,br as ve,bs as he,ak as Ae,bt as Be,av as Ie,u as De,d as ke,r as D,bu as Ce,bv as _e,bw as Oe,P as Te,ae as Se,bx as k,by as Ne,bz as Ve,bf as Ee,aG as we}from"./app-X261GMLD.js";import{A as $e,b as qe}from"./AppConfigFormHeader-CpKOoRvu.js";function Le(a,o){for(var r=-1,d=a==null?0:a.length,c=Array(d);++r<d;)c[r]=o(a[r],r,a);return c}var Re=1/0,G=P?P.prototype:void 0,z=G?G.toString:void 0;function K(a){if(typeof a=="string")return a;if(pe(a))return Le(a,K)+"";if(me(a))return z?z.call(a):"";var o=a+"";return o=="0"&&1/a==-Re?"-0":o}function xe(a){return a==null?"":K(a)}var Me=0;function je(a){var o=++Me;return xe(a)+o}const Pe={key:0,class:"q-field__bottom row items-start q-field__bottom--stale"},Ge={class:"q-field__messages col"},ze={__name:"AppArea",props:{label:{type:String,default:""},closeButton:{type:[Boolean,Object],default:!1},clearButton:{type:[Boolean,Object],default:!1},editButton:{type:[Boolean,Object],default:!1},addButton:{type:[Boolean,Object],default:!1},required:{type:Boolean,default:!1},hint:{type:String,default:""},error:{type:String,default:""},dragover:{type:Boolean,default:!1},highlighted:{type:Boolean,default:!1},disable:{type:Boolean,default:!1}},setup(a){const o=a,r=u(()=>o.error||o.hint);return(d,c)=>(s(),i($e,{label:a.label,"close-button":a.closeButton,"clear-button":a.clearButton,"edit-button":a.editButton,"add-button":a.addButton,required:a.required,disable:a.disable,class:Y([{"q-field--error":a.error},"b-area"])},{footer:y(()=>[r.value?(s(),T("div",Pe,[C("div",Ge,[C("div",null,F(r.value),1)])])):g("",!0)]),default:y(()=>[be(d.$slots,"default")]),_:3},8,["label","close-button","clear-button","edit-button","add-button","required","disable","class"]))}},Fe={__name:"AppCloseButton",setup(a){return(o,r)=>(s(),i(N,{class:"h-32 w-32",icon:S(ge),color:"grey-200",flat:"",round:"",padding:"4px"},null,8,["icon"]))}},Ye={__name:"AppSettingsButton",setup(a){return(o,r)=>(s(),i(N,{class:"h-32 w-32",icon:S(ye),color:"grey-200",flat:"",round:"",padding:"4px"},null,8,["icon"]))}},Ke={__name:"AppCopyButton",setup(a){return(o,r)=>(s(),i(N,{class:"h-32 w-32",icon:S(ve),color:"grey-200",flat:"",round:"",padding:"4px"},null,8,["icon"]))}},Ue=()=>{const a=he();return{redirectToConfigPage:async({id:r,type:d,data:c})=>{let t;switch(d){case"zone":c.isZonePt?t="pt_zones":t="zones";break;case"zone_group":t="zone_groups";break;case"controller":t="controllers";break;case"device":case"input":case"output":case"channel":c.device_index==Ae?t="controllers":t="devices";break}Be.value[t]=[r],a.push({name:t})}}},Qe={class:"row items-center gap-4 no-wrap ml-auto"},He=["title"],Xe={__name:"AppDragAndDropArea",props:{modelValue:{type:Array,default:()=>[]},label:{type:String,default:""},items:{type:[Array,Object],default:()=>[]},dataKey:{type:String,default:"index"},itemLabel:{type:String,default:"label"},itemTags:{type:String,default:"tags"},itemMarker:{type:String,default:"marker"},type:{type:[String,Array],required:!0},compareItems:{type:[Function,null],default:null},hint:{type:String,default:""},maxCount:{type:[String,Number],default:null},addButton:{type:[Boolean,Object],default:!1},editButton:{type:[Boolean,Object],default:!0},clearButton:{type:[Boolean,Object],default:!0},closeButton:{type:[Boolean,Object],default:!0},required:{type:Boolean,default:!1},rules:{type:Array,default:()=>[]},disable:{type:Boolean,default:!1},modalGroupOptions:{type:[Array,null],default:null}},emits:["update:modelValue","clickItem","editItem","add","copyItem"],setup(a,{emit:o}){const{redirectToConfigPage:r}=Ue(),d=we(),{t:c}=De(),t=a,v=o,{connectDropArea:U,disconnectDropArea:Q,highlightedDropAreas:H,disabledDropAreas:X,dataTransfer:V}=Ve(),E=u(()=>Array.isArray(t.type)?t.type:[t.type]),Z=u(()=>(e,n)=>e.marker-n.marker),_=u(()=>t.compareItems?t.compareItems:Z.value),w=u(()=>Array.isArray(t.items)?ke(t.items).sort(_.value):E.value.flatMap(e=>t.items[e]).sort(_.value)),h=je("drag-and-drop-area-"),O=u(()=>H.value.has(h)),J=u(()=>X.value.has(h)),m=D(!1);Ce(()=>{U(h,E.value)}),_e(()=>{Q(h)});const $=u(()=>{const e=new Map;return w.value.forEach(n=>{e.set(n.id,n)}),e});function b(e){return $.value.get(e).data[t.dataKey]}function q(e){return Array.from($.value.values()).find(n=>n.data[t.dataKey]===e)}const A=u(()=>{if(!m.value||!Array.isArray(V.value.itemIds))return[];const e=V.value.itemIds.map(b).filter(l=>!t.modelValue.includes(l)),n=e.length-(t.maxCount-t.modelValue.length);return t.maxCount!==null&&n&&e.splice(0,n),e}),B=D(new Set),L=u(()=>[...t.modelValue,...A.value].map(q).filter(Boolean).sort(_.value));function W(e){e.preventDefault(),m.value=!1}function ee(e){e.preventDefault(),e.dataTransfer.dropEffect="copy",O.value&&!t.disable&&(m.value=!0)}function te(e){e.forEach(n=>{B.value.add(n)}),I([...t.modelValue,...e])}function ae(e){e.preventDefault(),O.value&&te(A.value),m.value=!1}function ne(e){I(t.modelValue.filter(n=>n!==e))}const le=u(()=>m.value?`(${t.modelValue.length} + ${A.value.length})`:`(${t.modelValue.length})`);function oe(){f.value=null,B.value.clear()}const f=D(null),R=D(null);function x(){return f.value=null,t.required&&t.modelValue.length===0?f.value=c("error.required"):f.value=t.rules.map(e=>e()).find(e=>typeof e=="string"),!f.value}function re(){const e=x();return e||R.value.$el.scrollIntoView({behavior:"smooth",block:"center"}),e}Oe({validate:re,resetValidation:oe,requiresQForm:!0});function ue(){I(t.modelValue.filter(e=>q(e).nonDeletable))}function se(e){r(e)}const ie=u(()=>w.value.map(e=>{let n=e[t.itemLabel];return e[t.itemMarker]&&(n=`(${e[t.itemMarker]}) ${e[t.itemLabel]}`),{label:n,value:e.data[t.dataKey],group:e.data.group,disable:e.nonDeletable}})),de=u(()=>ie.value.filter(e=>!e.isNonDraggable||t.modelValue.includes(e.data[t.dataKey])));function M(){d.create({component:Ee,componentProps:{title:t.label,modelValue:t.modelValue,options:de.value,groupOptions:t.modalGroupOptions,maxCount:t.maxCount}}).onOk(e=>{const n=t.modelValue;e.filter(p=>!n.includes(p)).forEach(p=>{B.value.add(p)}),I(e)})}function I(e){v("update:modelValue",e)}Te(()=>t.modelValue,(e,n)=>{Se(e,n)||x()});const ce=u(()=>`${t.label} ${le.value}`);function j(){v("add")}function fe(){if(!t.disable)return t.addButton&&j()||t.editButton&&M()}return(e,n)=>(s(),i(ze,{ref_key:"areaRef",ref:R,"close-button":a.closeButton,"edit-button":a.editButton,"add-button":a.addButton,"clear-button":a.clearButton,label:ce.value,hint:a.hint,error:f.value,required:a.required,disable:a.disable,onClear:ue,onEdit:M,onAdd:j},{default:y(()=>[C("div",{onDragover:ee,onDrop:ae,onDragleave:W,class:Y(["b-area__inner",{"b-area__inner--dragover":m.value,"b-area__inner--highlighted":O.value,"b-area__inner--disable":a.disable,"b-area__inner--disable-drop":J.value,"b-area__inner--error":f.value}])},[L.value.length===0?(s(),T("div",{key:0,onClick:k(fe,["stop"]),class:"row col items-center justify-center non-selectable cursor-pointer text-grey-200"},F(e.DICTIONARY.CONFIGURATION.GENERAL.notSet),1)):(s(),i(Ne,{key:1,items:L.value,"virtual-scroll-item-size":48,class:"w-full b-area__items",tabindex:"-1"},{default:y(({item:l})=>[(s(),i(qe,{key:l.id,id:l.id,label:l[t.itemLabel],marker:l[t.itemMarker],tags:l[t.itemTags],stub:A.value.includes(b(l.id)),onLink:p=>se(l),linked:""},{"label-content":y(()=>[C("div",Qe,[B.value.has(b(l.id))||l.isNew?(s(),T("div",{key:0,class:"new-tree-item-indicator",title:e.DICTIONARY.GENERAL.LABEL.new},null,8,He)):g("",!0),l.copyable&&!a.disable?(s(),i(Ke,{key:1,"data-testid":"tree-item-copy-btn",onClick:k(p=>v("copyItem",b(l.id)),["stop"]),title:e.DICTIONARY.GENERAL.BUTTON.copy},null,8,["onClick","title"])):g("",!0),l.editable&&!a.disable?(s(),i(Ye,{key:2,"data-testid":"tree-item-settings-btn",onClick:k(p=>v("editItem",b(l.id)),["stop"]),title:e.DICTIONARY.GENERAL.BUTTON.changeParams},null,8,["onClick","title"])):g("",!0),!l.nonDeletable&&!a.disable?(s(),i(Fe,{key:3,onClick:k(p=>ne(b(l.id)),["stop"]),"data-testid":"tree-item-delete-btn",title:e.DICTIONARY.GENERAL.BUTTON.delete},null,8,["onClick","title"])):g("",!0)])]),_:2},1032,["id","label","marker","tags","stub","onLink"]))]),_:1},8,["items"]))],34)]),_:1},8,["close-button","edit-button","add-button","clear-button","label","hint","error","required","disable"]))}},We=Ie(Xe,[["__scopeId","data-v-cdc318c3"]]);export{We as A,Ue as u};
