import{cz as at,cA as re,cB as Ue,cC as st,cD as Ve,cE as ot,cF as me,cG as ye,cH as Be,cI as Ce,cJ as nt,cK as Oe,cL as ve,r as D,c as i,P as ie,cM as Ye,ca as ne,T as $e,cN as lt,cO as Pe,cP as it,c7 as Ke,cQ as rt,cR as ut,cS as ct,b as pe,a as _e,cm as Re,B as Me,as as we,aG as dt,cT as vt,cU as pt,av as ze,M as ue,cV as Se,o as g,e as q,w as R,f as p,ag as k,g as O,cW as Ne,h as I,n as K,cX as _t,cY as mt,bY as ft,bX as bt,bW as Je,bx as le,l as j,F as se,aF as ce,bo as W,cu as De,bZ as gt,ah as ge,cZ as qe,m as J,aX as Fe,cd as Et,c_ as Le,Q as Xe,c$ as We,af as xe,d0 as ke,d1 as Te,d2 as de,bF as fe,c3 as Ae,by as Tt,d3 as ht,bQ as yt,bC as Ct,d4 as et,d5 as Ot,bU as Nt,c2 as St,cf as Lt,d6 as xt}from"./app-X261GMLD.js";import{u as kt,_ as At}from"./AppJournalList-D7aET0qH.js";import{p as jt}from"./parseZoneRights-Ct1Qguht.js";function It(t){const u=[.06,6,50];return typeof t=="string"&&t.length&&t.split(":").forEach((T,_)=>{const m=parseFloat(T);m&&(u[_]=m)}),u}const $t=at({name:"touch-swipe",beforeMount(t,{value:u,arg:T,modifiers:_}){if(_.mouse!==!0&&re.has.touch!==!0)return;const m=_.mouseCapture===!0?"Capture":"",e={handler:u,sensitivity:It(T),direction:Ue(_),noop:st,mouseStart(n){Ve(n,e)&&ot(n)&&(me(e,"temp",[[document,"mousemove","move",`notPassive${m}`],[document,"mouseup","end","notPassiveCapture"]]),e.start(n,!0))},touchStart(n){if(Ve(n,e)){const v=n.target;me(e,"temp",[[v,"touchmove","move","notPassiveCapture"],[v,"touchcancel","end","notPassiveCapture"],[v,"touchend","end","notPassiveCapture"]]),e.start(n)}},start(n,v){re.is.firefox===!0&&ye(t,!0);const N=Be(n);e.event={x:N.left,y:N.top,time:Date.now(),mouse:v===!0,dir:!1}},move(n){if(e.event===void 0)return;if(e.event.dir!==!1){Ce(n);return}const v=Date.now()-e.event.time;if(v===0)return;const N=Be(n),L=N.left-e.event.x,c=Math.abs(L),r=N.top-e.event.y,o=Math.abs(r);if(e.event.mouse!==!0){if(c<e.sensitivity[1]&&o<e.sensitivity[1]){e.end(n);return}}else if(window.getSelection().toString()!==""){e.end(n);return}else if(c<e.sensitivity[2]&&o<e.sensitivity[2])return;const b=c/v,S=o/v;e.direction.vertical===!0&&c<o&&c<100&&S>e.sensitivity[0]&&(e.event.dir=r<0?"up":"down"),e.direction.horizontal===!0&&c>o&&o<100&&b>e.sensitivity[0]&&(e.event.dir=L<0?"left":"right"),e.direction.up===!0&&c<o&&r<0&&c<100&&S>e.sensitivity[0]&&(e.event.dir="up"),e.direction.down===!0&&c<o&&r>0&&c<100&&S>e.sensitivity[0]&&(e.event.dir="down"),e.direction.left===!0&&c>o&&L<0&&o<100&&b>e.sensitivity[0]&&(e.event.dir="left"),e.direction.right===!0&&c>o&&L>0&&o<100&&b>e.sensitivity[0]&&(e.event.dir="right"),e.event.dir!==!1?(Ce(n),e.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),nt(),e.styleCleanup=$=>{e.styleCleanup=void 0,document.body.classList.remove("non-selectable");const A=()=>{document.body.classList.remove("no-pointer-events--children")};$===!0?setTimeout(A,50):A()}),e.handler({evt:n,touch:e.event.mouse!==!0,mouse:e.event.mouse,direction:e.event.dir,duration:v,distance:{x:c,y:o}})):e.end(n)},end(n){e.event!==void 0&&(Oe(e,"temp"),re.is.firefox===!0&&ye(t,!1),e.styleCleanup!==void 0&&e.styleCleanup(!0),n!==void 0&&e.event.dir!==!1&&Ce(n),e.event=void 0)}};if(t.__qtouchswipe=e,_.mouse===!0){const n=_.mouseCapture===!0||_.mousecapture===!0?"Capture":"";me(e,"main",[[t,"mousedown","mouseStart",`passive${n}`]])}re.has.touch===!0&&me(e,"main",[[t,"touchstart","touchStart",`passive${_.capture===!0?"Capture":""}`],[t,"touchmove","noop","notPassiveCapture"]])},updated(t,u){const T=t.__qtouchswipe;T!==void 0&&(u.oldValue!==u.value&&(typeof u.value!="function"&&T.end(),T.handler=u.value),T.direction=Ue(u.modifiers))},beforeUnmount(t){const u=t.__qtouchswipe;u!==void 0&&(Oe(u,"main"),Oe(u,"temp"),re.is.firefox===!0&&ye(t,!1),u.styleCleanup!==void 0&&u.styleCleanup(),delete t.__qtouchswipe)}}),Pt={name:{required:!0},disable:Boolean},Qe={setup(t,{slots:u}){return()=>ne("div",{class:"q-panel scroll",role:"tabpanel"},Pe(u.default))}},Rt={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},Mt=["update:modelValue","beforeTransition","transition"];function wt(){const{props:t,emit:u,proxy:T}=Ye(),{getCache:_}=kt(),{registerTimeout:m}=ve();let e,n;const v=D(null),N=D(null);function L(s){const f=t.vertical===!0?"up":"left";B((T.$q.lang.rtl===!0?-1:1)*(s.direction===f?1:-1))}const c=i(()=>[[$t,L,void 0,{horizontal:t.vertical!==!0,vertical:t.vertical,mouse:!0}]]),r=i(()=>t.transitionPrev||`slide-${t.vertical===!0?"down":"right"}`),o=i(()=>t.transitionNext||`slide-${t.vertical===!0?"up":"left"}`),b=i(()=>`--q-transition-duration: ${t.transitionDuration}ms`),S=i(()=>typeof t.modelValue=="string"||typeof t.modelValue=="number"?t.modelValue:String(t.modelValue)),$=i(()=>({include:t.keepAliveInclude,exclude:t.keepAliveExclude,max:t.keepAliveMax})),A=i(()=>t.keepAliveInclude!==void 0||t.keepAliveExclude!==void 0);ie(()=>t.modelValue,(s,f)=>{const Z=w(s)===!0?M(s):-1;n!==!0&&F(Z===-1?0:Z<M(f)?-1:1),v.value!==Z&&(v.value=Z,u("beforeTransition",s,f),m(()=>{u("transition",s,f)},t.transitionDuration))});function E(){B(1)}function G(){B(-1)}function P(s){u("update:modelValue",s)}function w(s){return s!=null&&s!==""}function M(s){return e.findIndex(f=>f.props.name===s&&f.props.disable!==""&&f.props.disable!==!0)}function U(){return e.filter(s=>s.props.disable!==""&&s.props.disable!==!0)}function F(s){const f=s!==0&&t.animated===!0&&v.value!==-1?"q-transition--"+(s===-1?r.value:o.value):null;N.value!==f&&(N.value=f)}function B(s,f=v.value){let Z=f+s;for(;Z!==-1&&Z<e.length;){const ee=e[Z];if(ee!==void 0&&ee.props.disable!==""&&ee.props.disable!==!0){F(s),n=!0,u("update:modelValue",ee.props.name),setTimeout(()=>{n=!1});return}Z+=s}t.infinite===!0&&e.length!==0&&f!==-1&&f!==e.length&&B(s,s===-1?e.length:-1)}function H(){const s=M(t.modelValue);return v.value!==s&&(v.value=s),!0}function Y(){const s=w(t.modelValue)===!0&&H()&&e[v.value];return t.keepAlive===!0?[ne(it,$.value,[ne(A.value===!0?_(S.value,()=>({...Qe,name:S.value})):Qe,{key:S.value,style:b.value},()=>s)])]:[ne("div",{class:"q-panel scroll",style:b.value,key:S.value,role:"tabpanel"},[s])]}function oe(){if(e.length!==0)return t.animated===!0?[ne($e,{name:N.value},Y)]:Y()}function h(s){return e=lt(Pe(s.default,[])).filter(f=>f.props!==null&&f.props.slot===void 0&&w(f.props.name)===!0),e.length}function x(){return e}return Object.assign(T,{next:E,previous:G,goTo:P}),{panelIndex:v,panelDirectives:c,updatePanelsList:h,updatePanelIndex:H,getPanelContent:oe,getEnabledPanels:U,getPanels:x,isValidPanelName:w,keepAliveProps:$,needsUniqueKeepAliveWrapper:A,goToPanelByOffset:B,goToPanel:P,nextPanel:E,previousPanel:G}}const zt=Ke({name:"QTabPanel",props:Pt,setup(t,{slots:u}){return()=>ne("div",{class:"q-tab-panel",role:"tabpanel"},Pe(u.default))}}),Dt=Ke({name:"QTabPanels",props:{...Rt,...rt},emits:Mt,setup(t,{slots:u}){const T=Ye(),_=ut(t,T.proxy.$q),{updatePanelsList:m,getPanelContent:e,panelDirectives:n}=wt(),v=i(()=>"q-tab-panels q-panel-parent"+(_.value===!0?" q-tab-panels--dark q-dark":""));return()=>(m(u),ct("div",{class:v.value},e(),"pan",t.swipeable,()=>n.value))}}),tt=(t,u)=>{const T=pe(),_=_e(),m=i(()=>_.value.OBJECT_STATE_HANDBOOKS),e=i(()=>{const r=T.getters.getAuthUser,o=r==null?void 0:r.zone_access_rights;return o||[]}),n=i(()=>T.getters["objectState/ZONE_GROUP_COMPOSITION"]),v=i(()=>e.value.map(r=>jt(r))),N=r=>{const o=v.value.find(b=>b.index===r);return o?o.rights.map(b=>m.value.FILTERED_COMMANDS[b]).flat():[]},L=i(()=>{var o;if(!t.value)return[];let r=[];if(u.value=="zone"){r.push(...N(t.value.index));let b=[];(o=Object.entries(n.value))==null||o.forEach(([S,$])=>{$.includes(t.value.index)&&b.push(...N(Number(S)))}),b.forEach(S=>{r.includes(S)||r.push(S)})}else r.push(...N(t.value.index));return r.sort((b,S)=>b.filterIndex-S.filterIndex)}),c=D(null);return ie(()=>L.value,r=>{r.every(o=>{var b;return o.text!==((b=c.value)==null?void 0:b.text)})&&(c.value=null)}),{commandOptions:L,selectedCommand:c}},Zt=1e3,Ee=[];setInterval(()=>{Ee.length>0&&!Ze.value&&Gt(Ee.shift())},100);const Ze=D(!1),be=D(!1),je=D(null),He={SUCCESS:"Выполнено",ERROR:"Ошибка выполнения команды",PENDING:"Команда выполняется..."},Ge=()=>{const t=dt(),u=Re(),T=Me(),_=we(T.getters.LANGUAGE),m=_.OBJECT_STATE.TOAST,{ACP_COMMAND:e}=_.OBJECT_STATE_HANDBOOKS;return{executeControlCommand:(r,o,b=()=>{},S=()=>{})=>{if(!o){u.add(m.COMMAND_NOT_SELECTED);return}return new Promise($=>{const A=`${_.OBJECT_STATE.OBJECT_ZONE_ELEMENTS.EXECUTE_COMMAND} <b>${o.text}</b> ${_.GENERAL.LABEL.for} <b>${r.fullName}</b>`;t.create({title:_.OBJECT_STATE.OBJECT_ZONE_ELEMENTS.COMMAND_EXECUTION,message:A,html:!0,ok:{label:_.GENERAL.BUTTON.execute,color:"positive"},cancel:{label:_.GENERAL.BUTTON.cancel,class:"fill-input"}}).onOk(()=>{Ee.push({element:r,command:o,resolve:$,disableToast:!1}),b()}).onCancel(()=>{$(),S()})})},executeACPCommand:r=>new Promise(o=>{Ee.push({element:r,command:e,resolve:o,disableToast:!0})}),formatCommandResponse:({response:r,status:o},b=e)=>{let S,$,A,E;return b===e?$=Object.entries(r).map(([G,P])=>`
        <div class='text-base row justify-between gap-6 pb-6'>
          <span class='ellipsis'>${G}</span>
          <b>${P}</b>
        </div>
        `).join(""):$=null,S=`${b.text}: ${o}`,o=="Выполнено"?(A=vt,E="positive"):(A=pt,E="warning"),{title:S,content:$,color:E,icon:A}},CONTROL_COMMAND_ON_ELEMENTS:["input","output","reader","channel","device","controller"],ACP_COMMAND_ON_ELEMENTS:["input","output","device"]}};async function Gt({element:t,command:u,resolve:T,disableToast:_=!1}){const m=Re(),e=Me(),v=we(e.getters.LANGUAGE).OBJECT_STATE.TOAST;try{Ze.value=!0,await e.dispatch("objectState/getCommandResponse"),await e.dispatch("objectState/sendCommand",{index:t.index,commandNumber:u.number,type:t.type.value}),_||m.add(v.STATUS_200),clearInterval(je.value),je.value=setInterval(()=>Ut(T),Zt)}catch(N){console.error(N),N.status==503&&(_||m.add(v.STATUS_503)),N.status==400&&(_||m.add(v.STATUS_400)),Ie(),T()}}async function Ut(t){const u=Re(),T=Me(),m=we(T.getters.LANGUAGE).OBJECT_STATE.TOAST;if(!be.value)try{be.value=!0;const e=await T.dispatch("objectState/getCommandResponse");be.value=!1,e.data.status===He.ERROR&&u.add(m.ERROR_GET_RESPONSE),e.data.status!==He.PENDING&&(Ie(),t(e.data))}catch(e){console.error(e),e.status===503&&u.add(m.STATUS_503),e.status===400&&u.add(m.STATUS_400),Ie(),t()}}function Ie(){Ze.value=!1,be.value=!1,clearInterval(je.value)}const Vt={class:"object-zone__title text-h1 row justify-between items-center"},Bt={class:"mr-16"},Jt={class:"object-zone__filters"},qt={class:"row text-base gap-16"},Ft={class:"non-selectable"},Qt={class:"text-grey-200 ml-8 non-selectable"},Ht={class:"non-selectable"},Yt={class:"text-grey-200 ml-8 non-selectable"},Kt={class:"non-selectable"},Xt={class:"text-grey-200 ml-8 non-selectable"},Wt={class:"object-zone__mode print-hide"},ea={class:"object-zone__subtitle"},ta={key:0,class:"text-h2"},aa=["onClick","onKeydown","onContextmenu","data-testid"],sa={key:1,class:"zone-list__content-long"},oa={class:"execute-command"},na={class:"text-h1"},la={class:"row no-wrap items-center"},ia={__name:"AppObjectZone",setup(t){const{registerTimeout:u}=ve(),{executeControlCommand:T,formatCommandResponse:_}=Ge(),m=pe(),e=i(()=>m.getters["objectState/ZONE_GROUP_LIST"]),n=i(()=>m.getters["objectState/ZONE_LIST"]),v=i(()=>m.getters["objectState/ZONE_ELEMENT"]),N=(d,a)=>m.dispatch("objectState/setZoneElement",{type:d,key:a}),L=_e(),c=i(()=>L.value.OBJECT_STATE.OBJECT_ZONES),r=i({get(){return m.getters["objectState/OBJECT_ZONE_CONTROLLERS"]},set(d){m.commit("objectState/setObjectZoneControllers",d)}}),o=i({get(){return m.getters["objectState/OBJECT_ZONE_TAB"]},set(d){m.commit("objectState/setObjectZoneTab",d)}}),b=i({get(){return m.getters["objectState/OBJECT_ZONE_MODE"]},set(d){m.commit("objectState/setObjectZoneMode",d)}}),S=D(""),$=i(()=>m.getters["objectState/IS_POLLING_ZONES"]),A=d=>m.commit("objectState/setIsPollingZones",d),E=d=>m.commit("objectState/setIsLoadedZones",d),G=()=>m.dispatch("objectState/getZoneList"),P=()=>m.dispatch("objectState/getZoneGroupList"),w=()=>m.dispatch("objectState/getZoneGroupComposition");function M(){u(async function d(){const a=Date.now();await U();const l=Date.now();u(d,de-(l-a))})}M();async function U(){try{await G(),await P(),await w(),A(!1),E(!0)}catch(d){console.error(d),A(!0)}}const F=i(()=>{var d,a;return{zone:$.value?null:(d=n.value)==null?void 0:d.filter(l=>l.visibility),zone_group:$.value?null:(a=e.value)==null?void 0:a.filter(l=>l.visibility)}}),B=i(()=>F.value[o.value]?F.value[o.value].filter(d=>d.controller_index==ue).length:0),H=i(()=>F.value[o.value]?F.value[o.value].filter(d=>d.controller_index!=ue).length:0),Y=i(()=>{var d;return(d=F.value[o.value])==null?void 0:d.filter(a=>{let l=!1;return r.value==="all"?l=!0:r.value==="own"?l=a.controller_index==ue:r.value==="other"&&(l=a.controller_index!=ue),a.fullName.toLowerCase().includes(S.value.toLowerCase())&&l}).sort(Se)}),oe=i(()=>o.value==="zone"?c.value.ZONE_TITLE:c.value.ZONE_GROUP_TITLE);function h(d){var te;const a=((te=v.value)==null?void 0:te.key)===d.key?`outline-${d.color}`:`fill-${d.color}`,l=`zone-list__item-${b.value}`;return`${a} ${l}`}const x=D(!1),s=D(!1),f=D(null),Z=D(null);function ee(d,a){x.value=!0,s.value=d.target.closest(".zone-list__item"),f.value=a,Z.value=a.type.value}const X=D({});async function C(){X.value={response:null,loading:!1};const d=JSON.parse(JSON.stringify(f.value)),a=JSON.parse(JSON.stringify(z.value)),l=await T(d,a,()=>{X.value.loading=!0});l&&(X.value.response=_(l,a)),X.value.loading=!1}const{commandOptions:y,selectedCommand:z}=tt(f,Z),Q=i(()=>y.value.length===0);return(d,a)=>(g(),q(Te,{class:"object-zone no-shadow column no-wrap"},{default:R(()=>[p("div",Vt,[p("div",Bt,k(oe.value),1),p("div",Jt,[p("div",qt,[O(Ne,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=l=>r.value=l),val:"all",color:"primary",dense:"","data-testid":"all-radio"},{default:R(()=>[p("span",Ft,k(I(L).GENERAL.LABEL.all),1),p("span",Qt,k(B.value+H.value),1)]),_:1},8,["modelValue"]),O(Ne,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=l=>r.value=l),val:"own",color:"primary",dense:"","data-testid":"own-radio"},{default:R(()=>[p("span",Ht,k(c.value.OWN),1),p("span",Yt,k(B.value),1)]),_:1},8,["modelValue"]),O(Ne,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=l=>r.value=l),val:"other",color:"primary",dense:"","data-testid":"other-radio"},{default:R(()=>[p("span",Kt,k(c.value.OTHER),1),p("span",Xt,k(H.value),1)]),_:1},8,["modelValue"])]),p("div",Wt,[O(K,{icon:I(_t),color:b.value==="short"?"black":"grey",onClick:a[3]||(a[3]=l=>b.value="short"),flat:"",round:"","data-testid":"object-zone-short-btn"},null,8,["icon","color"]),O(K,{icon:I(mt),color:b.value==="long"?"black":"grey",onClick:a[4]||(a[4]=l=>b.value="long"),flat:"",round:"","data-testid":"object-zone-long-btn"},null,8,["icon","color"])])])]),p("div",ea,[O(ft,{modelValue:S.value,"onUpdate:modelValue":a[5]||(a[5]=l=>S.value=l),class:"object-zone__search"},null,8,["modelValue"]),O(bt,{modelValue:o.value,"onUpdate:modelValue":a[6]||(a[6]=l=>o.value=l),class:"b-tabs text-grey-200","indicator-color":"info","active-color":"info",dense:"","no-caps":""},{default:R(()=>[O(Je,{name:"zone",label:I(L).GENERAL.LABEL.zones,class:"b-zone-tab","data-testid":"object-zone-tab"},null,8,["label"]),O(Je,{name:"zone_group",label:I(L).GENERAL.LABEL.zoneGroups,class:"b-zone-tab","data-testid":"object-zone-tab-group"},null,8,["label"])]),_:1},8,["modelValue"])]),p("div",{class:"object-zone__content",onContextmenu:a[10]||(a[10]=le(()=>{},["prevent"]))},[O(Dt,{modelValue:o.value,"onUpdate:modelValue":a[7]||(a[7]=l=>o.value=l),"transition-duration":300,"transition-prev":"fade","transition-next":"fade",animated:"",class:"no-shadow full-height"},{default:R(()=>[(g(),j(se,null,ce(["zone","zone_group"],l=>O(zt,{name:l,key:l,class:"q-pa-none full-height"},{default:R(()=>{var te;return[((te=Y.value)==null?void 0:te.length)===0?(g(),j("div",ta,k(I(L).CONFIGURATION.GENERAL.listEmpty),1)):(g(),j("div",{key:1,class:W(["zone-list",`zone-list-${b.value}`])},[Y.value?(g(!0),j(se,{key:1},ce(Y.value,V=>(g(),j("div",{key:V.key,class:W([h(V),"zone-list__item text-h3 cursor-pointer"]),onClick:ae=>(N(V.type.value,V.key),x.value=!1),onKeydown:gt(ae=>(N(V.type.value,V.key),x.value=!1),["enter"]),onContextmenu:le(ae=>ee(ae,V),["prevent"]),tabindex:"0","data-testid":`object-zone-${V.type.value}-${V.key}`},[b.value==="short"?(g(),j("div",{key:0,class:W(["row items-center no-wrap full-height",{"justify-between":o.value==="zone_group","justify-center":o.value==="zone"}])},[o.value==="zone_group"?(g(),q(ge,{key:0,name:I(qe),class:"w-18 h-18"},null,8,["name"])):J("",!0),Fe(" "+k(V.number),1)],2)):(g(),j("div",sa,[o.value==="zone_group"?(g(),q(ge,{key:0,name:I(qe),class:"w-18 h-18 absolute",style:{top:"0",left:"0"}},null,8,["name"])):J("",!0),p("p",null,k(V.number),1),p("p",null,k(V.name),1),p("p",null,k(V.stateClassText),1)])),O(Et,{class:"bg-dark text-white q-pa-sm text-base",anchor:"top middle",offset:[0,35],delay:700},{default:R(()=>[Fe(k(V.fullName),1)]),_:2},1024)],42,aa))),128)):(g(),j(se,{key:0},ce(8,(V,ae)=>O(De,{key:ae})),64))],2))]}),_:2},1032,["name"])),64))]),_:1},8,["modelValue"]),O(Le,{modelValue:x.value,"onUpdate:modelValue":a[9]||(a[9]=l=>x.value=l),target:s.value,"no-parent-event":""},{default:R(()=>[p("div",oa,[p("div",na,k(c.value.SEND_COMMAND),1),p("div",la,[O(Xe,{modelValue:I(z),"onUpdate:modelValue":a[8]||(a[8]=l=>We(z)?z.value=l:null),options:I(y),label:Q.value?I(L).OBJECT_STATE.OBJECT_ZONE_ELEMENTS.NOT_FOUND:I(L).OBJECT_STATE.OBJECT_ZONE_ELEMENTS.CONTROL_COMMAND,disable:Q.value,dense:"","options-dense":"","option-value":"number","option-label":"text",class:"col q-mr-sm","data-testid":"menu-command-select"},null,8,["modelValue","options","label","disable"]),X.value?(g(),q(K,xe({key:0},X.value.response,{round:"",flat:"",padding:"xs","data-testid":"command-response-btn"}),{default:R(()=>[X.value.response?(g(),q(Le,{key:0,class:"bg-dark text-white q-pa-sm text-base"},{default:R(()=>[p("div",null,k(X.value.response.title),1)]),_:1})):J("",!0)]),_:1},16)):J("",!0),O(K,{icon:I(ke),loading:X.value.loading,color:"positive",round:"",flat:"",padding:"xs",class:"h-32 w-32",onClick:C,"data-testid":"execute-command-btn"},null,8,["icon","loading"])])])]),_:1},8,["modelValue","target"])],32)]),_:1}))}},ra=ze(ia,[["__scopeId","data-v-e96424d9"]]),ua={class:"zone-elements__title text-h1 row justify-between full-width"},ca={key:0,class:"zone-elements__content column no-wrap overflow-hidden"},da={class:"q-field-selected-item"},va={key:0,class:"zone-elements__target row justify-between items-center no-wrap"},pa={class:"text-h3 ellipsis"},_a={class:"zone-elements__buttons command-buttons print-hide"},ma={class:"element-list"},fa={key:1},ba={class:"text-h2"},ga={class:"list-item__content"},Ea={class:"text-base ellipsis-2-lines"},Ta={class:"list-item__buttons command-buttons print-hide"},ha=["innerHTML"],ya={__name:"AppObjectZoneElements",setup(t){const{registerTimeout:u,removeTimeout:T}=ve(),{formatCommandResponse:_,executeControlCommand:m,CONTROL_COMMAND_ON_ELEMENTS:e}=Ge(),n=pe(),v=i(()=>n.getters["objectState/ELEMENTS_LIST"]),N=i(()=>n.getters["objectState/ZONE_LIST"]),L=i(()=>n.getters["objectState/ZONE_GROUP_COMPOSITION"]),c=i(()=>n.getters["objectState/ZONE_ELEMENT"]),r=i(()=>n.getters["objectState/ZONE_ELEMENT_TYPE"]),o=C=>n.dispatch("objectState/getCounterElements",C),b=C=>n.dispatch("objectState/getZoneElements",C),S=C=>n.dispatch("objectState/setElementsList",C),$=i(()=>n.getters["objectState/IS_LOADING_ELEMENT_LIST"]),A=i(()=>n.getters.networkControllers),E=C=>n.commit("objectState/setIsLoadingElementList",C),G=(C,y)=>n.dispatch("objectState/setStateZoneElement",{type:C,key:y}),P=_e(),w=i(()=>P.value.OBJECT_STATE.OBJECT_ZONE_ELEMENTS),M=D({visible:!1,target:!1,response:null}),U=D({});async function F(C,y){var d;U.value[y.key]={response:null,loading:!1};const z=JSON.parse(JSON.stringify(x.value)),Q=await m(y,z,()=>{U.value[y.key].loading=!0});if(Q){const a=_(Q,z);U.value[y.key].response=a,M.value={target:(d=C.target.closest(".command-buttons"))==null?void 0:d.firstChild,visible:!0,response:a},Ct(()=>{H.value.updatePosition()})}U.value[y.key].loading=!1}function B(C,y){var z;M.value={target:(z=C.target.closest(".command-buttons"))==null?void 0:z.firstChild,visible:!0,response:U.value[y.key].response}}const H=D(null);async function Y(C,y){var z,Q;try{let d,a;switch(y){case"zone_group":d=(z=N.value)==null?void 0:z.filter(l=>L.value[C.index].includes(l.index)&&l.visibility).sort(Se);break;case"counter":a=await o(C.type),d=(Q=N.value)==null?void 0:Q.filter(l=>Ot(a.data).includes(l.index)).sort(Se);break;case"zone":a=await b(C.index),d=et.getFormattedZoneElements(a.data);break}if(C.index!==c.value.index)return;S(d),E(!1)}catch(d){console.error(d),E(!0)}}ie([c,r],async([C,y],[z])=>{if(C&&y&&(C==null?void 0:C.key)!==(z==null?void 0:z.key)){if(T(),U.value={},S([]),(y==="zone_group"||y==="zone")&&C.visibility===!1)return;E(!0),await Y(C,y),(y==="counter"||y==="zone")&&u(async function Q(){const d=Date.now();await Y(C,y);const a=Date.now();u(Q,de-(a-d))})}},{immediate:!0});const oe=i(()=>r.value==="counter"?P.value.COUNTERS[c.value.type]:r.value==="zone_group"?w.value.TITLE_ZONE_GROUPS:w.value.TITLE_ZONE),{commandOptions:h,selectedCommand:x}=tt(c,r),s=i(()=>h.value.length===0),f=i(()=>(r.value==="zone"||r.value==="zone_group")&&c.value.controller_index!=ue),Z=i(()=>{var C;return((C=c.value)==null?void 0:C.visibility)===!1}),ee=i(()=>Z.value?r.value==="zone"?w.value.HIDDEN_ZONE:w.value.HIDDEN_ZONE_GROUP:""),X=i(()=>{if(f.value){let{formattedName:C}=A.value.find(y=>y.index===c.value.controller_index);return`${r.value==="zone"?w.value.INTERPANEL_ZONE:w.value.INTERPANEL_ZONE_GROUP} ${C}`}else return""});return(C,y)=>(g(),q(Te,{class:"zone-elements no-shadow column no-wrap overflow-hidden"},{default:R(()=>{var z,Q,d;return[p("div",ua,[p("div",null,k(oe.value),1)]),r.value?(g(),j("div",ca,[r.value!="counter"?(g(),j(se,{key:0},[O(Xe,{modelValue:I(x),"onUpdate:modelValue":y[0]||(y[0]=a=>We(x)?x.value=a:null),options:I(h),label:s.value?w.value.NOT_FOUND:w.value.CONTROL_COMMAND,disable:s.value,dense:"","options-dense":"","option-value":"number","option-label":"text","data-testid":"command-select",class:"print-hide"},{"selected-item":R(a=>[p("span",da,k(a.opt.text),1)]),_:1},8,["modelValue","options","label","disable"]),c.value?(g(),j("div",va,[O(K,{class:W(`fill-${c.value.color}`),padding:"xs",dense:"",onClick:y[1]||(y[1]=a=>G(c.value.type.value,c.value.key)),"data-testid":"zone-element-btn"},{default:R(()=>[p("div",pa,k(c.value.fullName),1)]),_:1},8,["class"]),p("div",_a,[fe(O(K,xe((z=U.value[c.value.key])==null?void 0:z.response,{onClick:y[2]||(y[2]=le(a=>B(a,c.value),["stop"])),round:"",flat:"",padding:"xs","data-testid":"control-command-btn"}),null,16),[[Ae,(Q=U.value[c.value.key])==null?void 0:Q.response]]),O(K,{icon:I(ke),loading:(d=U.value[c.value.key])==null?void 0:d.loading,onClick:y[3]||(y[3]=le(a=>F(a,c.value),["stop"])),color:"positive",round:"",flat:"",padding:"xs","data-testid":"execute-command-btn"},null,8,["icon","loading"])])])):J("",!0)],64)):J("",!0),p("div",ma,[O($e,{name:"fade",mode:"out-in"},{default:R(()=>{var a;return[$.value?(g(),q(De,{key:0,height:"42px"})):((a=v.value)==null?void 0:a.length)===0?(g(),j("div",fa,[p("div",ba,k(Z.value?ee.value:f.value?X.value:I(P).CONFIGURATION.GENERAL.listEmpty),1)])):(g(),q(Tt,{key:2,items:v.value,class:"col h-full","virtual-scroll-item-size":"42"},{default:R(({item:l})=>[fe((g(),q(ht,{key:l.key,onClick:te=>G(l.type.value,l.key),class:"list-item",dense:"",clickable:"","data-testid":`${l.key}-list-item`},{default:R(()=>{var te,V,ae;return[p("div",ga,[p("div",{class:W(["list-item__mark",`fill-${l.color}`])},null,2),l.icon?(g(),q(ge,{key:0,name:l.icon,size:"24px"},null,8,["name"])):J("",!0),p("div",Ea,k(l.fullName),1)]),p("div",Ta,[fe(O(K,xe((te=U.value[l.key])==null?void 0:te.response,{onClick:le(he=>B(he,l),["stop"]),padding:"xs",round:"",flat:"","data-testid":"control-command-btn"}),null,16,["onClick"]),[[Ae,(V=U.value[l.key])==null?void 0:V.response]]),I(e).includes(l.type.value)?(g(),q(K,{key:0,icon:I(ke),loading:(ae=U.value[l.key])==null?void 0:ae.loading,onClick:le(he=>F(he,l),["stop"]),color:"positive",padding:"xs",round:"",flat:"","data-testid":"execute-command-btn"},null,8,["icon","loading","onClick"])):J("",!0)])]}),_:2},1032,["onClick","data-testid"])),[[yt]])]),_:1},8,["items"]))]}),_:1})])])):J("",!0),O(Le,{modelValue:M.value.visible,"onUpdate:modelValue":y[4]||(y[4]=a=>M.value.visible=a),target:M.value.target,offset:[0,40],anchor:"top middle",self:"top middle",class:"bg-dark text-white q-pa-sm text-base absolute",ref_key:"refCommandResponseMenu",ref:H,"auto-close":"","no-parent-event":""},{default:R(()=>[M.value.response?(g(),j(se,{key:0},[p("div",null,k(M.value.response.title),1),p("div",{innerHTML:M.value.response.content},null,8,ha)],64)):J("",!0)]),_:1},8,["modelValue","target"])]}),_:1}))}},Ca={class:"zone-state__title text-h1 row justify-between"},Oa={class:"zone-state__subtitle"},Na={class:"zone-state__name text-h2"},Sa={key:0,class:"zone-state__buttons print-hide"},La={key:0,class:"zone-state__list"},xa={key:0,class:"column gap-10"},ka={key:1,class:"text-h2"},Aa={key:2,class:"column gap-10"},ja={class:"text-base ellipsis-2-lines"},Ia={key:0,class:"zone-state__item-datetime text-base"},$a=["innerHTML"],Pa={__name:"AppObjectZoneState",setup(t){const{ACP_COMMAND_ON_ELEMENTS:u,executeACPCommand:T,formatCommandResponse:_}=Ge(),{registerTimeout:m,removeTimeout:e}=ve(),{registerTimeout:n}=ve(),v=pe(),N=i(()=>v.getters["objectState/STATE_ZONE_ELEMENT"]),L=i(()=>v.getters["objectState/STATE_ZONE_ELEMENT_TYPE"]),c=i(()=>v.getters["objectState/STATE_ELEMENT_LIST"]),r=h=>v.dispatch("objectState/getZoneGroupState",h),o=h=>v.dispatch("objectState/getZoneState",h),b=(h,x)=>v.dispatch("objectState/getElementState",{type:h,index:x}),S=h=>v.dispatch("objectState/setStateElementList",h),$=_e(),A=i(()=>$.value.OBJECT_STATE.OBJECT_ZONE_STATE),E=D("state");let G=null;const P=D(),w=D(),M=D();ie(E,()=>{E.value==="acp"?U(N.value):(P.value=!1,M.value=null,e())});async function U(h){M.value=h;const x=async()=>{var f;if(!M.value&&((f=M.value)==null?void 0:f.key)!==h.key){P.value=!1;return}P.value=!0;const s=await T(h);s&&M.value!==null&&(w.value=_(s)),P.value=!1};m(async function s(){const f=Date.now();await x();const Z=Date.now();n(s,de-(Z-f))})}const F=i(()=>L.value==="zone_group"?A.value.TITLE_ZONE_GROUPS:L.value==="zone"?A.value.TITLE_ZONE:A.value.TITLE_ELEMENT),B=D(!1);let H=!1;async function Y(h,x){var s;try{H=!0;let f;switch(x){case"zone_group":f=await r(h.index);break;case"zone":f=await o(h.index);break;default:f=await b(h.type.value,h.index);break}if((h==null?void 0:h.key)!==((s=N.value)==null?void 0:s.key))return;S(et.getFormattedStatesList(f.data)),B.value=!1}catch(f){console.error(f),B.value=!0}finally{H=!1}}let oe=null;return ie([N,L],async([h,x],[s])=>{if(h&&x&&(h==null?void 0:h.key)!==(s==null?void 0:s.key)){if(clearInterval(oe),clearInterval(G),w.value=null,P.value=!1,M.value=null,E.value="state",S([]),(x==="zone_group"||x==="zone")&&h.visibility===!1)return;B.value=!0,await Y(h,x),n(async function f(){H&&n(f,de);const Z=Date.now();await Y(h,x);const ee=Date.now();n(f,de-(ee-Z))})}},{immediate:!0}),(h,x)=>(g(),q(Te,{class:"zone-state no-shadow column"},{default:R(()=>[p("div",Ca,[p("div",null,k(F.value),1)]),N.value?(g(),j(se,{key:0},[p("div",Oa,[p("div",Na,k(N.value.fullName),1),L.value!=="zone"&&L.value!=="zone_group"&&I(u).includes(L.value)?(g(),j("div",Sa,[O(K,{class:W([E.value==="state"?"fill-primary":"outline-stroke","zone-state__button text-h3 bg-white"]),onClick:x[0]||(x[0]=s=>E.value="state"),label:A.value.TITLE_ELEMENT,"data-testid":"state-btn"},null,8,["class","label"]),O(K,{loading:P.value,class:W([E.value==="acp"?"fill-primary":"outline-stroke","zone-state__button text-h3 bg-white"]),onClick:x[1]||(x[1]=s=>E.value="acp"),label:A.value.ACP_TAB,"data-testid":"acp-btn"},null,8,["loading","class","label"])])):J("",!0)]),E.value==="state"?(g(),j("div",La,[O($e,{name:"fade",mode:"out-in"},{default:R(()=>[B.value?(g(),j("div",xa,[(g(),j(se,null,ce(3,(s,f)=>O(De,{key:f,height:"17px"})),64))])):c.value.length===0?(g(),j("div",ka,k(I($).CONFIGURATION.GENERAL.listEmpty),1)):(g(),j("div",Aa,[(g(!0),j(se,null,ce(c.value,s=>(g(),j("div",{key:s.text,class:"zone-state__item"},[p("div",{class:W(["zone-state__item-mark",`fill-${s.color}`])},null,2),p("div",ja,k(s.text),1),s.datetime?(g(),j("div",Ia,k(s.datetime),1)):J("",!0)]))),128))]))]),_:1})])):J("",!0),E.value==="acp"&&w.value?(g(),j("div",{key:1,class:"zone-state__list zone-state__acp overflow-auto",innerHTML:w.value.content},null,8,$a)):J("",!0)],64)):J("",!0)]),_:1}))}},Ra=ze(Pa,[["__scopeId","data-v-53c7cb70"]]),Ma={class:"object-journal__title"},wa={class:"text-h1 mr-8"},za={class:"open-journal text-h3"},Da={class:"object-journal__list"},Za={__name:"AppObjectJournal",setup(t){const u=_e(),T=i(()=>u.value.OBJECT_STATE.STATE_JOURNAL),_=pe(),m=Nt(),e=i(()=>_.getters["objectState/STATE_ZONE_ELEMENT"]),n=i(()=>_.getters["objectState/STATE_ZONE_ELEMENT_TYPE"]),v=i(()=>_.getters["objectState/IS_OPEN_JOURNAL"]),N=i(()=>_.getters["objectState/ELEMENTS_LIST"]),L=E=>_.commit("objectState/setIsOpenJournal",E),c=i(()=>_.getters["objectState/IS_LOADED_ZONES"]),r=i(()=>_.getters["journal/IS_JOURNAL_INITIALIZED"]);let o=!0;const b=E=>{_.commit("journal/setImmediateUpdateFilter",o),_.dispatch("journal/setJournalFilter",{...xt,...E}),o=!1};ie([e,n],([E,G])=>{if(!E||!G){b({});return}if(G==="zone_group")b({byZone:N.value.map(P=>`(${P.number}) ${P.name}`)});else if(G==="zone"){const P=`(${E.number}) ${E.name}`;b({byZone:[P]})}else b({byAddress:[E.number],byType:[u.value.JOURNAL.ELEMENT_TYPE[E.type.number]]})},{deep:!0,immediate:!0});const S=i(()=>{let E="";return e.value&&Object.keys(e.value).length&&(n.value==="zone"||n.value==="zone_group"?E=`(${e.value.number}) ${e.value.name}`:E=e.value.fullName),E?`${T.value.LAST_EVENTS} ${E}`:T.value.LAST_EVENTS}),$=i(()=>v.value?T.value.CLOSE_JOURNAL:T.value.OPEN_JOURNAL),A=i(()=>!c.value&&!r.value);return(E,G)=>(g(),q(Te,{class:W([{"object-journal--open":v.value},"object-journal no-shadow"])},{default:R(()=>[p("div",Ma,[p("div",wa,k(S.value),1),O(K,{onClick:G[0]||(G[0]=P=>L(!v.value)),color:"primary",flat:"",ripple:!1,"data-testid":"open-journal-btn"},{default:R(()=>[p("div",za,[p("span",{class:W({hidden:I(m).screen.lt.md})},k($.value),3),O(ge,{name:I(St),class:W([{"rotate-180":v.value},"dropdown-arrow"]),size:"sm"},null,8,["name","class"])])]),_:1})]),fe(p("div",Da,[A.value?J("",!0):(g(),q(At,{key:0,"hide-pagination":!I(m).screen.lt.lg},null,8,["hide-pagination"])),O(Lt,{showing:A.value,color:"primary"},null,8,["showing"])],512),[[Ae,v.value]])]),_:1},8,["class"]))}},Ga=ze(Za,[["__scopeId","data-v-a5736db9"]]),Ua={class:"object-state-page"},Va={class:"object-state-page__content gap-16"},Fa={__name:"AppObjectStatePage",setup(t){return(u,T)=>(g(),j("div",Ua,[p("div",Va,[O(ra,{class:"object-state-page__block object-state-page__zones"}),O(ya,{class:"object-state-page__block object-state-page__elements"}),O(Ra,{class:"object-state-page__block object-state-page__state"})]),O(Ga,{class:"object-state-page__journal"})]))}};export{Fa as default};
