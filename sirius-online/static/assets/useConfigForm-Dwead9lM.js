import{cm as $,u as x,bu as C,bv as G,a as A,r as d,i as D,ci as I,P as R,c as T,cn as B,ae as j,aa as k,d as U}from"./app-X261GMLD.js";const V=(a,o,l)=>a.filter(n=>n.index!=l&&n[o]!="").map(n=>n[o]);function q(){const a=$(),{t:o}=x();return{saveToast:t=>{const c=o(`toast.config.save.${t}.summary`),u=o(`toast.config.save.${t}.detail`);a.add({summary:c,detail:u,type:t})},deleteToast:t=>{const c=o(`toast.config.delete.${t}.summary`),u=o(`toast.config.delete.${t}.detail`);a.add({summary:c,detail:u,type:t})},maxElementsToast:t=>{const c=o("toast.config.limit.reach",{max:t});a.add({summary:c,type:"warning"})}}}const M=({onSave:a,onDelete:o,onReset:l})=>{const n=s=>{document.querySelector(".b-dialog-overlay")||(s.altKey&&s.code==="KeyS"&&(s.preventDefault(),a==null||a()),(s.altKey&&s.code==="KeyD"||s.key==="Delete")&&(s.preventDefault(),o==null||o()),s.altKey&&s.code==="KeyR"&&(s.preventDefault(),l==null||l()))};C(()=>{document.addEventListener("keydown",n)}),G(()=>{document.removeEventListener("keydown",n)})};function S({saveFn:a,deleteFn:o,resetFn:l,isCheckDirtyForm:n=!0}={}){const s=A(),t=d(),c=d(),u=d(),m=d(!1),i=d(!1),v=D("isNew",!1),{captureInterface:L,releaseInterface:g}=I();R([()=>m.value,()=>i.value],([e,r])=>{e||r?L():!e&&!r&&g()});const E=T(()=>s.value.GENERAL.BUTTON.delete),w=T(()=>s.value.GENERAL.BUTTON.save),f=d(null);M({onReset:()=>{var e;return(e=t.value)==null?void 0:e.reset()},onSave:()=>{var e;return(e=t.value)==null?void 0:e.submit()},onDelete:()=>{var e;return(e=f.value)==null?void 0:e.click()}});function N(){l==null||l({form:c}),u.value=U(c.value)}async function b(){try{await o()}catch(e){console.error(e)}finally{i.value=!1}}async function K(){var e;try{const r=await a();n&&r&&((e=t.value)==null||e.reset(),B.value=!1)}catch(r){console.error(r)}finally{m.value=!1}}return n&&(R(c,e=>{v.value||(B.value=!j(e,u.value))},{deep:!0}),k(()=>{B.value=!1})),N(),{onSave:K,onDelete:b,onReset:N,form:c,oldForm:u,formRef:t,deleteButtonRef:f,isSaving:m,isDeleting:i,deleteButtonLabel:E,saveButtonLabel:w,isNew:v}}function z({props:a,saveFn:o,deleteFn:l,resetFn:n}={}){const s=A(),{form:t,oldForm:c,formRef:u,deleteButtonRef:m,isSaving:i,isDeleting:v,deleteButtonLabel:L}=S(),{saveToast:g,deleteToast:E}=q(),w=T(()=>a.elements[0]),f=D("isNew",!1),N=D("resetAfterDelete",()=>{}),b=T(()=>a.elements.length>1),K=T(()=>f.value?s.value.GENERAL.BUTTON.add:s.value.GENERAL.BUTTON.save);function e(){n==null||n({form:t,mainFormElement:w,isMultipleEditing:b,isNew:f}),c.value=U(t.value)}async function r(){try{await l()&&(E("success"),N())}catch(y){console.error(y),E("error")}finally{v.value=!1}}async function O(){var y;try{await o()&&(g("success"),(y=u.value)==null||y.reset(),B.value=!1)}catch(h){console.error(h),g("error")}finally{i.value=!1}}return R(()=>a==null?void 0:a.elements,e,{immediate:!0}),{onSave:O,onDelete:r,onReset:e,form:t,formRef:u,deleteButtonRef:m,isSaving:i,isDeleting:v,isNew:f,isMultipleEditing:b,mainFormElement:w,deleteButtonLabel:L,saveButtonLabel:K}}export{q as a,S as b,V as g,z as u};
